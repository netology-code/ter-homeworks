# –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ –∫ –∑–∞–Ω—è—Ç–∏—é ¬´–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –º–µ—Ç–æ–¥—ã —Ä–∞–±–æ—Ç—ã —Å Terraform¬ª

### –¶–µ–ª–∏ –∑–∞–¥–∞–Ω–∏—è

1. –ù–∞—É—á–∏—Ç—å—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–¥—É–ª–∏.
2. –û—Ç—Ä–∞–±–æ—Ç–∞—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–∏ state.
3. –ó–∞–∫—Ä–µ–ø–∏—Ç—å –ø—Ä–æ–π–¥–µ–Ω–Ω—ã–π –º–∞—Ç–µ—Ä–∏–∞–ª.


### –ß–µ–∫-–ª–∏—Å—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫ –¥–æ–º–∞—à–Ω–µ–º—É –∑–∞–¥–∞–Ω–∏—é

1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –∞–∫–∫–∞—É–Ω—Ç –≤ Yandex Cloud. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –ø—Ä–æ–º–æ–∫–æ–¥ –Ω–∞ –≥—Ä–∞–Ω—Ç.
2. –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç Yandex CLI.
3. –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ [**04/src**](https://github.com/netology-code/ter-homeworks/tree/main/04/src).
4. –õ—é–±—ã–µ –í–ú, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∑–∞–¥–∞–Ω–∏—è, –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø—Ä–µ—Ä—ã–≤–∞–µ–º—ã–º–∏, –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ —Å—Ä–µ–¥—Å—Ç–≤.

------
### –í–Ω–∏–º–∞–Ω–∏–µ!! –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ–º –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–ª—É—á–∏–≤—à–∏–π—Å—è –∫–æ–¥ –≤ –≤–∏–¥–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ –≤–∞—à github-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π!
–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤–∞—à–∞ –≤–µ—Ä—Å–∏—è **Terraform** ~>1.12.0
–ü–∏—à–µ–º –∫—Ä–∞—Å–∏–≤—ã–π –∫–æ–¥, —Ö–∞—Ä–¥–∫–æ–¥ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–µ –¥–æ–ø—É—Å—Ç–∏–º—ã!
------
ssh -l alexlinux 51.250.71.191
sudo apt update && sudo apt install wget -y

wget https://hashicorp-releases.yandexcloud.net/terraform/1.12.0/terraform_1.12.0_linux_amd64.zip

sudo apt update
sudo apt install unzip -y

unzip terraform_1.12.0_linux_amd64.zip
sudo mv terraform /usr/local/bin/

curl -sSL https://storage.yandexcloud.net/yandexcloud-yc/install.sh | bash

nano ~/.terraformrc

provider_installation {
  network_mirror {
    url = "https://terraform-mirror.yandexcloud.net/"
    include = ["registry.terraform.io/*/*"]
  }
  direct {
    exclude = ["registry.terraform.io/*/*"]
  }
}



ls -la ~/.terraformrc

cat ~/.terraformrc

mkdir ~/terraform-project

cd ~/terraform-project

cd ~/terraform-project/modules

cd ~/terraform-project/modules/marketing_vm

========================
cd /home/alexlinux/terraform-check
cd /home/alexlinux/terraform-project/ter-homeworks
cd ~/terraform-project/ter-homeworks/04/src
cd ~/terraform-project/ter-homeworks
find ~/ -path "*/04/src" -type d 2>/dev/null
/home/alexlinux/terraform-project/ter-homeworks/04/src
cd ~/terraform-project/ter-homeworks/terraform-hotfix
cd ~/ter-homeworks-new/validation_test
cd ~/ter-homeworks-newcd ~/ter-homeworks-new/04/src
cd ~/ter-homeworks-new
===================

### –ó–∞–¥–∞–Ω–∏–µ 1

1. –í–æ–∑—å–º–∏—Ç–µ –∏–∑ [–¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –∫ –ª–µ–∫—Ü–∏–∏ –≥–æ—Ç–æ–≤—ã–π –∫–æ–¥](https://github.com/netology-code/ter-homeworks/tree/main/04/demonstration1) –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å –ø–æ–º–æ—â—å—é –¥–≤—É—Ö –≤—ã–∑–æ–≤–æ–≤ remote-–º–æ–¥—É–ª—è -> –¥–≤—É—Ö –í–ú, –æ—Ç–Ω–æ—Å—è—â–∏—Ö—Å—è –∫ —Ä–∞–∑–Ω—ã–º –ø—Ä–æ–µ–∫—Ç–∞–º(marketing –∏ analytics) –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ labels –¥–ª—è –æ–±–æ–∑–Ω–∞—á–µ–Ω–∏—è –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏.  –í —Ñ–∞–π–ª–µ cloud-init.yml –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –¥–ª—è ssh-–∫–ª—é—á–∞ –≤–º–µ—Å—Ç–æ —Ö–∞—Ä–¥–∫–æ–¥–∞. –ü–µ—Ä–µ–¥–∞–π—Ç–µ ssh-–∫–ª—é—á –≤ —Ñ—É–Ω–∫—Ü–∏—é template_file –≤ –±–ª–æ–∫–µ vars ={} .
–í–æ—Å–ø–æ–ª—å–∑—É–π—Ç–µ—Å—å [**–ø—Ä–∏–º–µ—Ä–æ–º**](https://grantorchard.com/dynamic-cloudinit-content-with-terraform-file-templates/). –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ ssh-authorized-keys –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –≤ —Å–µ–±—è —Å–ø–∏—Å–æ–∫, –∞ –Ω–µ —Å—Ç—Ä–æ–∫—É.
3. –î–æ–±–∞–≤—å—Ç–µ –≤ —Ñ–∞–π–ª cloud-init.yml —É—Å—Ç–∞–Ω–æ–≤–∫—É nginx.
4. –ü—Ä–µ–¥–æ—Å—Ç–∞–≤—å—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∫–æ–Ω—Å–æ–ª–∏ –∏ –≤—ã–≤–æ–¥ –∫–æ–º–∞–Ω–¥—ã ```sudo nginx -t```, —Å–∫—Ä–∏–Ω—à–æ—Ç –∫–æ–Ω—Å–æ–ª–∏ –í–ú yandex cloud —Å –∏—Ö –º–µ—Ç–∫–∞–º–∏. –û—Ç–∫—Ä–æ–π—Ç–µ terraform console –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤—å—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –º–æ–¥—É–ª—è. –ü—Ä–∏–º–µ—Ä: > module.marketing_vm
------
–í —Å–ª—É—á–∞–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è MacOS –≤—ã –ø–æ–ª—É—á–∏—Ç–µ –æ—à–∏–±–∫—É "Incompatible provider version" . –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ —Å–∫–∞—á–∞–π—Ç–µ remote –º–æ–¥—É–ª—å –ª–æ–∫–∞–ª—å–Ω–æ –∏ –ø–æ–ø—Ä–∞–≤—å—Ç–µ –≤ –Ω–µ–º –≤–µ—Ä—Å–∏—é template –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –Ω–∞ –±–æ–ª–µ–µ —Å—Ç–∞—Ä—É—é.
------
1.1

mkdir templates
cd ~/terraform-project/templates

nano cloud-init.yml

#cloud-config
users:
  - name: ubuntu
    groups: sudo
    shell: /bin/bash
    sudo: ['ALL=(ALL) NOPASSWD:ALL']
    ssh-authorized-keys:



      - ${ssh_public_key}

package_update: true
package_upgrade: true

packages:
  - docker.io
  - docker-compose
  - nginx

write_files:
  - path: /etc/docker/daemon.json
    content: |
      {
        "exec-opts": ["native.cgroupdriver=systemd"],
        "log-driver": "json-file",
        "log-opts": {
          "max-size": "100m"
        },
        "storage-driver": "overlay2"
      }

runcmd:
  - systemctl enable docker
  - systemctl start docker
  - usermod -aG docker ubuntu
  - systemctl enable nginx
  - systemctl start nginx
  - ufw allow 'Nginx HTTP'
  - echo "Cloud-init completed successfully for ${vm_project}" > /etc/motd



# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Terraform
terraform init

# –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–µ–º –ø–ª–∞–Ω
terraform plan

# –ü—Ä–∏–º–µ–Ω—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
terraform apply

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —á—Ç–æ–±—ã —Å–∫–∞—á–∞—Ç—å –º–æ–¥—É–ª—å
terraform init

# –°–º–æ—Ç—Ä–∏–º —á—Ç–æ —Å–∫–∞—á–∞–ª–æ—Å—å
ls -la .terraform/modules/

# –ò–∑—É—á–∞–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –º–æ–¥—É–ª—è
find .terraform/modules/ -name "*.tf" -exec grep -l "variable" {} \;

find . -name "*.yml" -o -name "*.tf"



1.3

1. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∫–æ–Ω—Å–æ–ª–∏ –í–ú –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ nginx bash Copy Download 
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ marketing VM 

ssh ubuntu@<external_ip_marketing_vm> 

# –í—ã–ø–æ–ª–Ω–∏—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫—É –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ 

nginx sudo nginx -t

# –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π SSH –∫–ª—é—á
ssh-keygen -t ed25519 -f ~/.ssh/netology_terraform -N ""

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∞–≥–µ–Ω—Ç –∏ –¥–æ–±–∞–≤—å—Ç–µ –∫–ª—é—á
eval "$(ssh-agent -s)"
ssh-add ~/.ssh/netology_terraform

# –ü–æ–∫–∞–∂–∏—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –¥–ª—è Terraform
cat ~/.ssh/netology_terraform.pub

–û–±–Ω–æ–≤–∏—Ç–µ Terraform –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
–î–æ–±–∞–≤—å—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –≤ personal.auto.tfvars:
vms_ssh_root_key = "ssh-ed2551******49887"




cat ~/.ssh/netology_terraform.pub

# –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π SSH –∫–ª—é—á
ssh-keygen -t ed25519 -f ~/.ssh/netology_terraform -N ""

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ SSH –∞–≥–µ–Ω—Ç
eval "$(ssh-agent -s)"
ssh-add ~/.ssh/netology_terraform

# –ü–æ–∫–∞–∂–∏—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á
cat ~/.ssh/netology_terraform.pub


# –£–Ω–∏—á—Ç–æ–∂—å—Ç–µ —Å—Ç–∞—Ä—ã–µ –í–ú
terraform destroy -auto-approve

# –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–µ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –∫–ª—é—á–æ–º
terraform apply -auto-approve

# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ marketing VM
ssh -i ~/.ssh/netology_terraform ubuntu@89.169.133.106

# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ analytics VM  
ssh -i ~/.ssh/netology_terraform ubuntu@46.21.244.226


marketing-vm  ssh -l ubuntu 62.84.118.106
analytics-vm   ssh -l ubuntu 84.201.173.239

# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ marketing VM
ssh -i ~/.ssh/netology_terraform ubuntu@62.84.118.106

# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ analytics VM  
ssh -i ~/.ssh/netology_terraform ubuntu@62.84.118.106

ssh -i ~/.ssh/netology_terraform ubuntu@84.201.173.239

cat ~/.ssh/yandex_cloud.pub
ssh-ed25519 AAAAC3NzaC1lZD********+XyzMr26Oo ubuntu

token     = "t1.9euelZqbjsyN***EiHzrFLXvoVTal5yDw"
  cloud_id  = "b1gtb****36b87"
  folder_id = "b1go*****292eobjh"
vms_ssh_root_key = "ssh-ed25**********zMr26Oo ubuntu"


ssh -i ~/.ssh/netology_terraform ubuntu@84.201.172.242

terraform console

# –ü—Ä–æ—Å–º–æ—Ç—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –º–æ–¥—É–ª–µ marketing_vm
> module.marketing_vm

# –ü—Ä–æ—Å–º–æ—Ç—Ä –º–µ—Ç–æ–∫ –í–ú
> yandex_compute_instance.marketing_vm.labels

# –ü—Ä–æ—Å–º–æ—Ç—Ä –≤–Ω–µ—à–Ω–µ–≥–æ IP
> yandex_compute_instance.marketing_vm.network_interface[0].nat_ip_address

# –ü—Ä–æ—Å–º–æ—Ç—Ä –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ IP
> yandex_compute_instance.marketing_vm.network_interface[0].ip_address

# –ü—Ä–æ—Å–º–æ—Ç—Ä –∏–º–µ–Ω–∏ –í–ú
> yandex_compute_instance.marketing_vm.name

# –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –≤—ã—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –º–æ–¥—É–ª—è
> module.marketing_vm.external_ip
> module.marketing_vm.internal_ip


 –û–±–Ω–æ–≤–∏—Ç–µ –ø–∞–∫–µ—Ç—ã
sudo apt update

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ nginx
sudo apt install nginx -y

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ nginx
sudo systemctl start nginx
sudo systemctl enable nginx

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å
sudo systemctl status nginx

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
sudo nginx -t

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å
curl http://localhost



terraform plan-auto-approve

export TF_VAR_yc_token="–≤t1.***iHzrFLXvoVTal5yDw"
export TF_VAR_yc_cloud_id="–≤b1*****06h9636b87"
export TF_VAR_yc_folder_id="b1g*******1292eobjh"
export TF_VAR_vms_ssh_root_key="ssh-ed2*****r26Oo ubuntu"

token     = "t1.9eu******y8fNmJ7Hy5iYLXvoVTal5yDw"
  cloud_id  = "b1g****87"
  folder_id = "b1go****objh"
vms_ssh_root_key = "ssh-ed255********26Oo ubuntu"

# –ü–æ–ª—É—á–∏—Ç–µ ID —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å–µ—Ç–∏ yc vpc network get develop --format json | jq -r '.id' # –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Å–µ—Ç—å –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ Terraform terraform import yandex_vpc_network.network <network_id>

terraform import yandex_vpc_network.network enp545ue11stlfmkiq38

# –ü–æ–ª—É—á–∏—Ç–µ —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –æ–±—Ä–∞–∑–æ–≤ Ubuntu
yc compute image list --folder-id standard-images | grep ubuntu

# –ò–ª–∏ –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –≤—Å–µ –æ–±—Ä–∞–∑—ã
yc compute image list --folder-id standard-images --limit 50


# –ù–∞–π–¥–∏—Ç–µ —Ñ–∞–π–ª—ã —Å –Ω–µ–æ–±—ä—è–≤–ª–µ–Ω–Ω—ã–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏
find . -name "*.tfvars" -type f

# –ï—Å–ª–∏ –µ—Å—Ç—å personal.auto.tfvars, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –µ–≥–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
cat personal.auto.tfvars

# –£–¥–∞–ª–∏—Ç–µ –∏–ª–∏ –∏—Å–ø—Ä–∞–≤—å—Ç–µ –µ–≥–æ
rm -f personal.auto.tfvars

 fd84nt41ssoaapgql97p | ubuntu-22-04-lts-v20231211                                 | ubuntu-2204-lts                                 | f2e53j470jtfbk7qttna           | READY


# –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º analytics-vm
terraform import yandex_compute_instance.analytics_vm fhm4q5cn60ke3alo6g5l

# –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º marketing-vm (—á–µ—Ä–µ–∑ –º–æ–¥—É–ª—å)
terraform import module.marketing_vm.yandex_compute_instance.marketing_vm fhmoms5aj4a0qohe9o61

# –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π vms_ssh_root_key
grep "vms_ssh_root_key" terraform.tfvars

# –ò–ª–∏ –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á
cat ~/.ssh/yandex_cloud.pub


alexlinux@compute-vm-2-2-10-hdd-176**887:~/terraform-project$ grep "vms_ssh_root_key" terraform.tfvars
vms_ssh_root_key = "ssh-ed25*********qa2Y4nEm+XyzMr26Oo ubuntu"

ssh -l <–∏–º—è_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è> 84.252.128.69

ssh -l ubuntu 51.250.10.145


# –£–¥–∞–ª–∏—Ç–µ —Å—Ç–∞—Ä—ã–µ –∑–∞–ø–∏—Å–∏ –¥–ª—è —ç—Ç–∏—Ö IP
ssh-keygen -f ~/.ssh/known_hosts -R '89.169.144.179'
ssh-keygen -f ~/.ssh/known_hosts -R '84.252.128.69' 
ssh-keygen -f ~/.ssh/known_hosts -R '51.250.10.145'



# –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –≤—Å–µ SSH –∫–ª—é—á–∏
ls -la ~/.ssh/

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø—É–±–ª–∏—á–Ω—ã—Ö –∫–ª—é—á–µ–π
cat ~/.ssh/yandex_cloud.pub
cat ~/.ssh/netology_terraform.pub


# –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –∫–ª—é—á
ssh-keygen -t ed25519 -f ~/.ssh/terraform_vms -C "ubuntu" -N ""

# –ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á
cat ~/.ssh/terraform_vms.pub

# –£–Ω–∏—á—Ç–æ–∂—å—Ç–µ —Å—Ç–∞—Ä—ã–µ –í–ú –∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–µ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –∫–ª—é—á–æ–º
terraform destroy -auto-approve

# –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–µ –í–ú
terraform apply -auto-approve


# –ù–∞–π–¥–∏—Ç–µ —Ñ–∞–π–ª—ã —Å –Ω–µ–æ–±—ä—è–≤–ª–µ–Ω–Ω—ã–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏
find . -name "*.auto.tfvars" -type f

# –£–¥–∞–ª–∏—Ç–µ –∏–ª–∏ –∏—Å–ø—Ä–∞–≤—å—Ç–µ –∏—Ö
rm -f personal.auto.tfvars
# 2. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Å–µ—Ç—å –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ Terraform
terraform import yandex_vpc_network.network $(yc vpc network get marketing-network --format json | jq -r '.id')

# 3. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –ø–æ–¥—Å–µ—Ç—å –µ—Å–ª–∏ –æ–Ω–∞ –µ—Å—Ç—å
terraform import yandex_vpc_subnet.subnet $(yc vpc subnet get marketing-subnet --format json | jq -r '.id')

# 4. –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
terraform plan
terraform apply -auto-approve


# –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —á—Ç–æ —Å–µ–π—á–∞—Å –≤ main.tf
cat main.tf | grep -A 10 -B 2 "yandex_vpc_network"

yc compute instance delete marketing-vm
yc compute instance delete analytics-vm


yc vpc network delete marketing-network
yc vpc network delete terraform-network


terraform console

# –í–º–µ—Å—Ç–æ data.yandex_vpc_network.existing –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:
> yandex_vpc_network.network.id
> yandex_vpc_network.network.name
> yandex_vpc_subnet.subnet.v4_cidr_blocks
> module.marketing_vm.external_ip
> yandex_compute_instance.analytics_vm.network_interface[0].nat_ip_address


ssh -i ~/.ssh/yandex_cloud ubuntu@46.21.246.164

ssh -i ~/.ssh/yandex_cloud ubuntu@89.169.159.69

ssh -l <–∏–º—è_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è> 46.21.246.164

ssh -l <–∏–º—è_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è> 89.169.159.69



 module.marketing_vm
# –í–Ω–µ—à–Ω–∏–π IP –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤–æ–π –í–ú
> module.marketing_vm.external_ip

# –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π IP –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤–æ–π –í–ú  
> module.marketing_vm.internal_ip

# ID –∏–Ω—Å—Ç–∞–Ω—Å–∞ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤–æ–π –í–ú
> module.marketing_vm.instance_id

# –ú–µ—Ç–∫–∏ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤–æ–π –í–ú
> module.marketing_vm.labels

# –ò–º—è –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤–æ–π –í–ú
> module.marketing_vm.name

# –ú–µ—Ç–∫–∏ analytics –í–ú
> yandex_compute_instance.analytics_vm.labels

# –í–Ω–µ—à–Ω–∏–π IP analytics –í–ú
> yandex_compute_instance.analytics_vm.network_interface[0].nat_ip_address

# –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π IP analytics –í–ú
> yandex_compute_instance.analytics_vm.network_interface[0].ip_address

# –ò–º—è analytics –í–ú
> yandex_compute_instance.analytics_vm.name


# –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ—Ç–∏
> yandex_vpc_network.network.name
> yandex_vpc_network.network.id

# –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–¥—Å–µ—Ç–∏
> yandex_vpc_subnet.subnet.name
> yandex_vpc_subnet.subnet.v4_cidr_blocks

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥ –≤—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:

nginx: nginx: configuration file /etc/nginx/nginx.conf syntax is ok

–ú–µ—Ç–∫–∏ –í–ú: JSON —Å environment, owner, project

IP –∞–¥—Ä–µ—Å–∞: –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –≤–Ω–µ—à–Ω–∏–µ –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ IP

–°–æ—Å—Ç–æ—è–Ω–∏–µ –º–æ–¥—É–ª—è: –ø–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–∞—Ö

–í—Å—ë –≥–æ—Ç–æ–≤–æ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏! –ü–æ–¥–∫–ª—é—á–∞–π—Ç–µ—Å—å –∫ –í–ú –∏ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Ä–∞–±–æ—Ç—É nginx.

ssh-keygen -t ed25519 -f ~/.ssh/terraform_vms -C "ubuntu" -N ""







ssh -i ~/.ssh/netology_terraform ubuntu@89.169.158.148

ssh -l ubuntu 84.201.175.11
ssh -l ubuntu 84.201.132.162
ssh -l alexlinux 62.84.116.153
 cd ~/terraform-project
ssh -i ~/.ssh/terraform_rsa ubuntu@84.201.132.162
ssh -i ~/.ssh/terraform_rsa ubuntu@84.201.175.11



cd ~/terraform-project

# –ü–æ—Å–º–æ—Ç—Ä–∏–º –∫–∞–∫–æ–π –∫–ª—é—á –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
grep "vms_ssh_root_key" terraform.tfvars

# –ü—Ä–æ–≤–µ—Ä–∏–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –í–ú –≤ main.tf
grep -A 10 -B 5 "metadata" main.tf

# –°–æ–∑–¥–∞–¥–∏–º –Ω–æ–≤—ã–π –∫–ª—é—á
ssh-keygen -t ed25519 -f ~/.ssh/terraform_final -C "ubuntu" -N ""

# –ü—Ä–æ—Å–º–æ—Ç—Ä–∏–º –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á
cat ~/.ssh/terraform_final.pub

# –ü–æ–ª—É—á–∏—Ç–µ –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω 
yc iam create-token


cat > terraform.tfvars << 'EOF'
yc_token = "t1.*******fPwBrSUvRi5riS3ZJRkAA"
yc_cloud_id = "b1gt********6b87"
yc_folder_id = "b1gok**********bjh"
vms_ssh_root_key = "ssh-ed25519 AAAA***********FqXj6yo1 ubuntu" 
EOF


# –ü—Ä–æ–≤–µ—Ä–∏–º –±–ª–æ–∫ metadata –≤ main.tf
grep -A 5 -B 5 "metadata" main.tf

 –ü–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º
 terraform init

terraform validate
terraform plan

# –ü—Ä–∏–º–µ–Ω–∏–º —Å –Ω–æ–≤–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
terraform apply -auto-approve

# –ü–æ–ª—É—á–∏–º –Ω–æ–≤—ã–µ IP –∞–¥—Ä–µ—Å–∞
terraform output

# –ü–æ–¥–∫–ª—é—á–∏–º—Å—è —Å –Ω–æ–≤—ã–º –∫–ª—é—á–æ–º
ssh -i ~/.ssh/terraform_final ubuntu@$(terraform output -raw marketing_vm_ip)

# –ü—Ä–æ–≤–µ—Ä–∏–º –µ—Å—Ç—å –ª–∏ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á
ls -la ~/.ssh/ | grep "ed25519"

# –ï—Å–ª–∏ –Ω–µ—Ç, —Å–æ–∑–¥–∞–¥–∏–º –Ω–æ–≤—ã–π –∫–ª—é—á
ssh-keygen -t ed25519 -f ~/.ssh/terraform_vms -C "ubuntu" -N ""

# –û–±–Ω–æ–≤–∏–º terraform.tfvars —Å –Ω–æ–≤—ã–º –∫–ª—é—á–æ–º
echo 'vms_ssh_root_key = "'$(cat ~/.ssh/terraform_vms.pub)'"' >> terraform.tfvars

# –ü–µ—Ä–µ–∑–∞–ø–∏—à–∏—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–ª—é—á 
ssh-keygen -t ed25519 -f ~/.ssh/terraform_vms -C "ubuntu" -N ""

–ß—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –Ω–æ–≤—ã–π –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á:
cat ~/.ssh/terraform_vms.pub

# –û—á–∏—Å—Ç–∏–º –∫—ç—à –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π 
rm -rf .terraform


# –ü–æ–ª—É—á–∏–º IP –∞–¥—Ä–µ—Å–∞
terraform output

# –ü–æ–¥–∫–ª—é—á–∏–º—Å—è –∫ –í–ú —Å –Ω–æ–≤—ã–º –∫–ª—é—á–æ–º
ssh -i ~/.ssh/terraform_vms ubuntu@$(terraform output -raw marketing_vm_ip)

# –ù–∞ –í–ú –≤—ã–ø–æ–ª–Ω–∏–º –ø—Ä–æ–≤–µ—Ä–∫—É nginx
sudo nginx -t
sudo systemctl status nginx
curl http://localhost
sudo cat /etc/yandex-cloud/labels.json

sudo apt update

terraform console

# –ú–µ—Ç–∫–∏ marketing VM
> module.marketing_vm.labels

# –ú–µ—Ç–∫–∏ analytics VM  
> yandex_compute_instance.analytics_vm.labels

# –í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–æ–¥—É–ª–µ
> module.marketing_vm

 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSH config
bash
# –°–æ–∑–¥–∞–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
nano ~/.ssh/config
–î–æ–±–∞–≤—å—Ç–µ:

text
Host marketing-vm
    HostName 84.201.132.162
    User ubuntu
    IdentityFile ~/.ssh/terraform_rsa
    IdentitiesOnly yes

Host analytics-vm
    HostName 84.201.175.11
    User ubuntu
    IdentityFile ~/.ssh/terraform_rsa
    IdentitiesOnly yes
–¢–µ–ø–µ—Ä—å –ø–æ–¥–∫–ª—é—á–∞–π—Ç–µ—Å—å –ø—Ä–æ—Å—Ç–æ:

bash
ssh marketing-vm
ssh analytics-vm







# –£–¥–∞–ª–∏–º —Å—Ç–∞—Ä—ã–µ –∑–∞–ø–∏—Å–∏ –¥–ª—è —ç—Ç–∏—Ö IP
ssh-keygen -f ~/.ssh/known_hosts -R '62.84.124.108'
ssh-keygen -f ~/.ssh/known_hosts -R '51.250.7.254'

# –ò–ª–∏ —É–¥–∞–ª–∏–º –≤—Å–µ —Å—Ç–∞—Ä—ã–µ –∑–∞–ø–∏—Å–∏ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
# rm -f ~/.ssh/known_hosts

# –ü–æ–¥–∫–ª—é—á–∏–º—Å—è –∫ marketing-vm
ssh -i ~/.ssh/terraform_vms ubuntu@62.84.124.108

# –ù–∞ –≤–æ–ø—Ä–æ—Å "Are you sure you want to continue connecting (yes/no)?" –≤–≤–µ–¥–∏—Ç–µ yes

# –ò–ª–∏ –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π –±–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
ssh -o StrictHostKeyChecking=no -i ~/.ssh/terraform_vms ubuntu@62.84.124.108
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ nginx –µ—Å–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
sudo apt update
sudo apt install nginx -y

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ nginx
sudo systemctl start nginx
sudo systemctl enable nginx

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
sudo nginx -t

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å
sudo systemctl status nginx

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å
curl http://localhost

# –ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –º–µ—Ç–∫–∏ –í–ú
sudo cat /etc/yandex-cloud/labels.json

cd ~/terraform-project
terraform console

# –ú–µ—Ç–∫–∏ marketing VM
> module.marketing_vm.labels

# –ú–µ—Ç–∫–∏ analytics VM
> yandex_compute_instance.analytics_vm.labels

# IP –∞–¥—Ä–µ—Å–∞
> module.marketing_vm.external_ip
> yandex_compute_instance.analytics_vm.network_interface[0].nat_ip_address

# –ü–æ—Å–º–æ—Ç—Ä–∏–º –∫–∞–∫–æ–π –∫–ª—é—á —É–∫–∞–∑–∞–Ω –≤ terraform.tfvars
cat terraform.tfvars

# –ü—Ä–æ–≤–µ—Ä–∏–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –Ω–∞—à–µ–≥–æ –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞
cat ~/.ssh/terraform_vms

# –°–æ–∑–¥–∞–¥–∏–º –Ω–æ–≤—ã–π –∫–ª—é—á
ssh-keygen -t rsa -b 4096 -f ~/.ssh/terraform_rsa -C "ubuntu" -N ""

# –ü—Ä–æ—Å–º–æ—Ç—Ä–∏–º –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á
cat ~/.ssh/terraform_rsa.pub

cd ~/terraform-project

# –£–Ω–∏—á—Ç–æ–∂–∏–º –≤—Å–µ —Ä–µ—Å—É—Ä—Å—ã
terraform destroy -auto-approve

# –û–±–Ω–æ–≤–∏–º terraform.tfvars —Å –Ω–æ–≤—ã–º –∫–ª—é—á–æ–º
nano terraform.tfvars


---------------------

# –£–Ω–∏—á—Ç–æ–∂–∏–º —Å—Ç–∞—Ä—ã–µ –í–ú
terraform destroy -auto-approve

# –û—á–∏—Å—Ç–∏–º –∫—ç—à
rm -rf .terraform

# –ü–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º
terraform init

# –ü—Ä–∏–º–µ–Ω–∏–º —Å –Ω–æ–≤—ã–º –∫–ª—é—á–æ–º
terraform apply -auto-approve



































### –ó–∞–¥–∞–Ω–∏–µ 2

1. –ù–∞–ø–∏—à–∏—Ç–µ –ª–æ–∫–∞–ª—å–Ω—ã–π –º–æ–¥—É–ª—å vpc, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å 2 —Ä–µ—Å—É—Ä—Å–∞: **–æ–¥–Ω—É** —Å–µ—Ç—å –∏ **–æ–¥–Ω—É** –ø–æ–¥—Å–µ—Ç—å –≤ –∑–æ–Ω–µ, –æ–±—ä—è–≤–ª–µ–Ω–Ω–æ–π –ø—Ä–∏ –≤—ã–∑–æ–≤–µ –º–æ–¥—É–ª—è, –Ω–∞–ø—Ä–∏–º–µ—Ä: ```ru-central1-a```.
2. –í—ã –¥–æ–ª–∂–Ω—ã –ø–µ—Ä–µ–¥–∞—Ç—å –≤ –º–æ–¥—É–ª—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º —Å–µ—Ç–∏, zone –∏ v4_cidr_blocks.
3. –ú–æ–¥—É–ª—å –¥–æ–ª–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –≤ root module —Å –ø–æ–º–æ—â—å—é output –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ yandex_vpc_subnet. –ü—Ä–∏—à–ª–∏—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏–∑ terraform console –æ —Å–≤–æ–µ–º –º–æ–¥—É–ª–µ. –ü—Ä–∏–º–µ—Ä: > module.vpc_dev  
4. –ó–∞–º–µ–Ω–∏—Ç–µ —Ä–µ—Å—É—Ä—Å—ã yandex_vpc_network –∏ yandex_vpc_subnet —Å–æ–∑–¥–∞–Ω–Ω—ã–º –º–æ–¥—É–ª–µ–º. –ù–µ –∑–∞–±—É–¥—å—Ç–µ –ø–µ—Ä–µ–¥–∞—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–µ—Ç–∏ –∏–∑ –º–æ–¥—É–ª—è vpc –≤ –º–æ–¥—É–ª—å —Å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–æ–π.
5. –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –∫ –º–æ–¥—É–ª—é —Å –ø–æ–º–æ—â—å—é terraform-docs.
 
–ü—Ä–∏–º–µ—Ä –≤—ã–∑–æ–≤–∞

```
module "vpc_dev" {
  source       = "./vpc"
  env_name     = "develop"
  zone = "ru-central1-a"
  cidr = "10.0.1.0/24"
}
```
--------------------------------------

2.1

mkdir modules/vpc/main.tf

mkdir modules/vpc

cd ~/terraform-project/modules/vpc

nano main.tf
resource "yandex_vpc_network" "network" {
  name = var.network_name
}

resource "yandex_vpc_subnet" "subnet" {
  name           = var.subnet_name
  zone           = var.zone
  network_id     = yandex_vpc_network.network.id
  v4_cidr_blocks = [var.cidr_blocks]
}



nano variables.tf

# modules/vpc/variables.tf

variable "network_name" {
  description = "Name of the VPC network"
  type        = string
  default     = "vpc-network"
}

variable "subnet_name" {
  description = "Name of the subnet"
  type        = string
  default     = "vpc-subnet"
}

variable "zone" {
  description = "Availability zone for the subnet"
  type        = string
}

variable "cidr_blocks" {
  description = "CIDR block for the subnet"
  type        = string
  default     = "192.168.10.0/24"
}


nano outputs.tf


# modules/vpc/outputs.tf

output "network_id" {
  description = "ID of the created VPC network"
  value       = yandex_vpc_network.network.id
}

output "subnet_id" {
  description = "ID of the created subnet"
  value       = yandex_vpc_subnet.subnet.id
}

output "network_name" {
  description = "Name of the created VPC network"
  value       = yandex_vpc_network.network.name
}

output "subnet_cidr_blocks" {
  description = "CIDR blocks of the created subnet"
  value       = yandex_vpc_subnet.subnet.v4_cidr_blocks
}
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–æ–¥—É–ª—è –≤ –æ—Å–Ω–æ–≤–Ω–æ–º main.tf

# main.tf

# –ú–æ–¥—É–ª—å VPC
module "vpc" {
  source = "./modules/vpc"

  network_name = "terraform-network"
  subnet_name  = "terraform-subnet"
  zone         = "ru-central1-a"
  cidr_blocks  = "192.168.60.0/24"
}

# –ú–æ–¥—É–ª—å marketing_vm
module "marketing_vm" {
  source = "./modules/marketing_vm"

  subnet_id      = module.vpc.subnet_id  # –ò—Å–ø–æ–ª—å–∑—É–µ–º –≤—ã—Ö–æ–¥ –º–æ–¥—É–ª—è VPC
  ssh_public_key = var.vms_ssh_root_key
  zone           = "ru-central1-a"
}

resource "yandex_compute_instance" "analytics_vm" {
  name        = "analytics-vm"
  platform_id = "standard-v3"
  zone        = "ru-central1-a"
  
  allow_stopping_for_update = true

  resources {
    cores  = 2
    memory = 2
  }

  boot_disk {
    initialize_params {
      image_id = "fd8vmcue7laqlq63s4nm"
      size     = 20
    }
  }

  network_interface {
    subnet_id = module.vpc.subnet_id  # –ò—Å–ø–æ–ª—å–∑—É–µ–º –≤—ã—Ö–æ–¥ –º–æ–¥—É–ª—è VPC
    nat       = true
  }

  metadata = {
    ssh-keys = "ubuntu:${var.vms_ssh_root_key}"
  }

  labels = {
    environment = "analytics"
    owner       = "analytics-team"
    project     = "terraform"
  }
}


–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
bash
# –£–¥–∞–ª–∏–º —Å—Ç–∞—Ä—ã–µ —Ä–µ—Å—É—Ä—Å—ã —Å–µ—Ç–∏
terraform destroy -target=yandex_vpc_network.network -target=yandex_vpc_subnet.subnet -auto-approve

# –ü–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥—É–ª—è VPC
terraform init

# –ü—Ä–æ–≤–µ—Ä–∏–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
terraform validate

# –ü–æ—Å–º–æ—Ç—Ä–∏–º –ø–ª–∞–Ω
terraform plan

# –ü—Ä–∏–º–µ–Ω–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
terraform apply -auto-approve
üíª –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ Terraform console
bash
terraform console

> module.vpc.subnet_id
> module.vpc.network_id
> module.marketing_vm.external_ip
> yandex_compute_instance.analytics_vm.network_interface[0].nat_ip_address

terraform init

# –ù–∞–π–¥–µ–º –≤—Å–µ —Ñ–∞–π–ª—ã –≥–¥–µ —É–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è hashicorp/yandex
grep -r "hashicorp/yandex" .

# –ò–ª–∏ –ø–æ–∏—â–µ–º –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö
grep -r "hashicorp" modules/
find . -name "*.tf" -exec grep -l "hashicorp" {} \;
üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–æ –≤—Å–µ—Ö –º–æ–¥—É–ª—è—Ö



# –ó–∞–º–µ–Ω–∏–º –≤—Å–µ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è hashicorp/yandex –Ω–∞ yandex-cloud/yandex
find . -name "*.tf" -exec sed -i 's/hashicorp\/yandex/yandex-cloud\/yandex/g' {} \;

# –ò–ª–∏ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å —Ç–æ–ª—å–∫–æ source
find . -name "*.tf" -exec sed -i 's/source *= *["'"'"']hashicorp\/yandex["'"'"']/source = "yandex-cloud\/yandex"/g' {} \;

# –£–¥–∞–ª–∏–º –≤—Å–µ –±–ª–æ–∫–∏ terraform –∏–∑ –¥—Ä—É–≥–∏—Ö —Ñ–∞–π–ª–æ–≤ find . -name "*.tf" -exec sed -i '/^terraform {/,/^}/d' {} \;

# –°–æ–∑–¥–∞–¥–∏–º versions.tf –≤ –∫–æ—Ä–Ω–µ
cat > versions.tf << 'EOF'
terraform {
  required_version = ">= 1.0"

  required_providers {
    yandex = {
      source  = "yandex-cloud/yandex"
      version = ">= 0.171.0"
    }
  }
}
EOF

# –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞
rm -rf .terraform .terraform.lock.hcl

# –ü–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
terraform init

# –ü—Ä–æ–≤–µ—Ä–∫–∞
terraform validate

 terraform providers

 nano modules/marketing_vm/main.tf

nano modules/vpc/main.tf



terraform force-unlock 268b6466-a5ea-ac77-f35d-5db6708f4117

# –£–¥–∞–ª–∏–º lock —Ñ–∞–π–ª
rm -f .terraform.tfstate.lock.info

# –ò–ª–∏ –µ—Å–ª–∏ –æ–Ω –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –∏–Ω–∞—á–µ
find . -name "*.lock*" -delete


terraform plan -lock=false
terraform apply -lock=false -auto-approve


# –û—Å—Ç–∞–Ω–æ–≤–∏–º –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã Terraform
pkill terraform

# –£–¥–∞–ª–∏–º –≤—Å–µ lock —Ñ–∞–π–ª—ã
find . -name "*.lock*" -delete
rm -rf .terraform

# –ü–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º
terraform init


# –£–¥–∞–ª–∏–º –≤—Å–µ lock —Ñ–∞–π–ª—ã –∏ –∫—ç—à
rm -rf .terraform .terraform.lock.hcl .terraform.tfstate.lock.info

# –ü–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º
terraform init

# –ù–∞–π–¥–µ–º –∏ —É–¥–∞–ª–∏–º –≤—Å–µ lock —Ñ–∞–π–ª—ã
find . -name "*.lock*" -delete

# –ü—Ä–æ–≤–µ—Ä–∏–º —á—Ç–æ –Ω–µ—Ç —Å–∫—Ä—ã—Ç—ã—Ö lock —Ñ–∞–π–ª–æ–≤
ls -la .terraform*


# –£–¥–∞–ª–∏–º –≤—Å—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é .terraform
rm -rf .terraform

# –ü–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º
terraform init


# –ü–æ–ø—Ä–æ–±—É–µ–º —Å–Ω—è—Ç—å –ª—é–±—É—é –≤–æ–∑–º–æ–∂–Ω—É—é –±–ª–æ–∫–∏—Ä–æ–≤–∫—É
terraform force-unlock -force




terraform plan -lock=false
terraform apply -lock=false -auto-approve


# –£–¥–∞–ª–∏–º –í–ú —Å–Ω–∞—á–∞–ª–∞
terraform destroy -target=yandex_compute_instance.analytics_vm -target=module.marketing_vm -auto-approve -lock=false

# –¢–µ–ø–µ—Ä—å —É–¥–∞–ª–∏–º –ø–æ–¥—Å–µ—Ç—å –∏ —Å–µ—Ç—å
terraform destroy -target=yandex_vpc_subnet.subnet -target=yandex_vpc_network.network -auto-approve -lock=false

# –û—á–∏—Å—Ç–∏–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ Terraform rm -f terraform.tfstate terraform.tfstate.backup # –ü—Ä–∏–º–µ–Ω–∏–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∑–∞–Ω–æ–≤–æ terraform apply -auto-approve -lock=false



–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã –º–æ–¥—É–ª—è VPC
–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è:

bash
# –ü—Ä–æ–≤–µ—Ä–∏–º –≤—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
terraform output

# Terraform console
terraform console

> module.vpc.network_id
> module.vpc.subnet_id
> module.vpc.network_name
> module.vpc.subnet_cidr_blocks
üìã –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –í–ú
bash
# –ü–æ–ª—É—á–∏–º –Ω–æ–≤—ã–µ IP –∞–¥—Ä–µ—Å–∞
MARKETING_IP=$(terraform output -raw marketing_vm_ip)
ANALYTICS_IP=$(terraform output -raw analytics_vm_ip)

# –ü–æ–¥–∫–ª—é—á–∏–º—Å—è –∫ marketing-vm
ssh -i ~/.ssh/terraform_rsa ubuntu@$MARKETING_IP

# –ù–∞ –í–ú –≤—ã–ø–æ–ª–Ω–∏–º:
sudo apt update && sudo apt install nginx -y
sudo systemctl start nginx
sudo systemctl enable nginx
sudo nginx -t
curl http://localhost
sudo cat /etc/yandex-cloud/labels.json
–ò–º–ø–æ—Ä—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å–µ—Ç–∏ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
bash
# –ù–∞–π–¥–µ–º ID —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å–µ—Ç–∏
NETWORK_ID=$(yc vpc network get terraform-network --format json | jq -r '.id')
SUBNET_ID=$(yc vpc subnet get terraform-subnet --format json | jq -r '.id')

# –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Å–µ—Ç—å –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–æ–¥—É–ª—è VPC
terraform import module.vpc.yandex_vpc_network.network $NETWORK_ID

# –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ–¥—Å–µ—Ç—å –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–æ–¥—É–ª—è VPC
terraform import module.vpc.yandex_vpc_subnet.subnet $SUBNET_ID


# 1. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ä–µ—Å—É—Ä—Å—ã
terraform import module.vpc.yandex_vpc_network.network $(yc vpc network get terraform-network --format json | jq -r '.id')
terraform import module.vpc.yandex_vpc_subnet.subnet $(yc vpc subnet get terraform-subnet --format json | jq -r '.id')

# 2. –ü—Ä–æ–≤–µ—Ä–∏–º –ø–ª–∞–Ω - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å "No changes"
terraform plan -lock=false

# 3. –ü—Ä–∏–º–µ–Ω–∏–º –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –í–ú
terraform apply -auto-approve -lock=false


–ë—ã—Å—Ç—Ä–æ–µ —Ä–µ—à–µ–Ω–∏–µ
bash
# –£–¥–∞–ª–∏–º —Å—Ç–∞—Ä—É—é —Å–µ—Ç—å –∏ —Å–æ–∑–¥–∞–¥–∏–º –Ω–æ–≤—É—é —Å –¥—Ä—É–≥–∏–º –∏–º–µ–Ω–µ–º
yc vpc subnet delete terraform-subnet
yc vpc network delete terraform-network

# –û–±–Ω–æ–≤–∏–º main.tf —Å –Ω–æ–≤—ã–º–∏ –∏–º–µ–Ω–∞–º–∏
sed -i 's/terraform-network/terraform-vpc-module/g' main.tf
sed -i 's/terraform-subnet/terraform-vpc-subnet/g' main.tf
sed -i 's/192.168.60.0\/24/192.168.80.0\/24/g' main.tf

# –ü—Ä–∏–º–µ–Ω–∏–º
terraform apply -auto-approve -lock=false



# –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –ø–æ–¥—Å–µ—Ç—å –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–æ–¥—É–ª—è VPC terraform import module.vpc.yandex_vpc_subnet.subnet $(yc vpc subnet get terraform-subnet --format json | jq -r '.id')

# –£–¥–∞–ª–∏–º —Å—Ç–∞—Ä—ã–µ –í–ú
terraform destroy -target=yandex_compute_instance.analytics_vm -target=module.marketing_vm -auto-approve -lock=false

# –ü—Ä–∏–º–µ–Ω–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π –ø–æ–¥—Å–µ—Ç–∏ –∏ –í–ú
terraform apply -auto-approve -lock=false

–°–æ–∑–¥–∞–¥–∏–º –Ω–æ–≤—É—é –ø–æ–¥—Å–µ—Ç—å —Å –¥—Ä—É–≥–∏–º –∏–º–µ–Ω–µ–º –∏ CIDR
–û–±–Ω–æ–≤–∏—Ç–µ main.tf:

hcl
module "vpc" {
  source = "./modules/vpc"

  network_name = "terraform-network"
  subnet_name  = "vpc-module-subnet"    # –ù–û–í–û–ï –∏–º—è –ø–æ–¥—Å–µ—Ç–∏
  zone         = "ru-central1-a"
  cidr_blocks  = "192.168.200.0/24"     # –ù–û–í–´–ô CIDR
}
# –£–¥–∞–ª–∏–º –±–ª–æ–∫ terraform –∏–∑ main.tf
 sed -i '/^terraform {/,/^}/d' main.tf


# –ü—Ä–æ–≤–µ—Ä–∏–º –≤—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
terraform output

# –ü—Ä–æ–≤–µ—Ä–∏–º –º–æ–¥—É–ª—å VPC
terraform output vpc_network_info

# Terraform console
terraform console

> module.vpc.network_id
> module.vpc.subnet_id
> module.marketing_vm.external_ip

==============
alexlinux@compute-vm-2-2-10-hdd-1763671349887:~/terraform-project$ terraform output
analytics_vm_ip = "158.160.47.34"
marketing_vm_info = {
  "external_ip" = "46.21.244.161"
  "internal_ip" = "192.168.200.13"
  "name" = "fhm903ct0p66pg7fjq42"
}
marketing_vm_internal_ip = "192.168.200.13"
marketing_vm_ip = "46.21.244.161"
ssh_connection_commands = {
  "analytics" = "ssh -i ~/.ssh/yandex_cloud ubuntu@158.160.47.34"
  "marketing" = "ssh -i ~/.ssh/yandex_cloud ubuntu@46.21.244.161"
}
vpc_network_info = {
  "cidr_blocks" = tolist([
    "192.168.200.0/24",
  ])
  "network_id" = "enp8he3d37dhk5tnvjri"
  "network_name" = "terraform-network"
  "subnet_id" = "e9bb4n2aq8g6qlqtdpn4"
}
alexlinux@compute-vm-2-2-10-hdd-1763671349887:~/terraform-project$ terraform output vpc_network_info
{
  "cidr_blocks" = tolist([
    "192.168.200.0/24",
  ])
  "network_id" = "enp8*********vjri"
  "network_name" = "terra*********
  "subnet_id" = "e9bb4n*****tdpn4"
}
alexlinux@compute-vm-2-2-10-hdd-17636349887:~/terraform-project$ terraform console
> module.vpc.network_id
"enp8he3d37dhk5tnvjri"
> module.vpc.subnet_id
"e9bb4n2aq8g6qlqtdpn4"
> module.marketing_vm.external_ip
"46.21.244.161"


========

2.2 –í—ã –¥–æ–ª–∂–Ω—ã –ø–µ—Ä–µ–¥–∞—Ç—å –≤ –º–æ–¥—É–ª—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º —Å–µ—Ç–∏, zone –∏ v4_cidr_blocks.

-------------------
main.tf –æ–±–Ω–æ–≤–∏—Ç–µ –≤—ã–∑–æ–≤ –º–æ–¥—É–ª—è VPC:

hcl
# –ú–æ–¥—É–ª—å VPC
module "vpc" {
  source = "./modules/vpc"

  # –ü–µ—Ä–µ–¥–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ –º–æ–¥—É–ª—å
  network_name = "my-vpc-network"       # –Ω–∞–∑–≤–∞–Ω–∏–µ —Å–µ—Ç–∏
  zone         = "ru-central1-a"        # –∑–æ–Ω–∞
  cidr_blocks  = "192.168.100.0/24"     # v4_cidr_blocks


# –£–¥–∞–ª–∏–º –ø–æ–¥—Å–µ—Ç—å –∏–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è Terraform terraform state rm module.vpc.yandex_vpc_subnet.subnet # –ü—Ä–æ–≤–µ—Ä–∏–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ terraform state list


# –ü—Ä–æ–≤–µ—Ä–∏–º —á—Ç–æ –º–æ–¥—É–ª—å VPC —Ä–∞–±–æ—Ç–∞–µ—Ç
terraform output vpc_network_info

# –ü—Ä–æ–≤–µ—Ä–∏–º —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥–∞–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
terraform console

> module.vpc.network_name
> module.vpc.subnet_cidr_blocks
  module.vpc.zone

# –ü–æ–¥–∫–ª—é—á–∏–º—Å—è –∫ –í–ú
ssh -i ~/.ssh/terraform_rsa ubuntu@$(terraform output -raw marketing_vm_ip)

# –ù–∞ –í–ú —É—Å—Ç–∞–Ω–æ–≤–∏–º nginx –∏ –ø—Ä–æ–≤–µ—Ä–∏–º –º–µ—Ç–∫–∏
sudo apt update && sudo apt install nginx -y
sudo systemctl start nginx
sudo nginx -t
curl http://localhost
sudo cat /etc/yandex-cloud/labels.json



–£–Ω–∏—á—Ç–æ–∂–∏–º –í–ú
terraform destroy -target=yandex_compute_instance.analytics_vm -target=module.marketing_vm -auto-approve -lock=false

–ü—Ä–∏–º–µ–Ω–∏–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∑–∞–Ω–æ–≤–æ
terraform apply -auto-approve -lock=false

# –ü—Ä–æ–≤–µ—Ä–∏–º –Ω–æ–≤—ã–µ IP –∞–¥—Ä–µ—Å–∞
terraform output

# –ü–æ–¥–∫–ª—é—á–∏–º—Å—è –∫ marketing-vm
ssh -i ~/.ssh/terraform_rsa ubuntu@$(terraform output -raw marketing_vm_ip)

# –ù–∞ –í–ú –≤—ã–ø–æ–ª–Ω–∏–º:
sudo apt update && sudo apt install nginx -y
sudo systemctl start nginx
sudo systemctl enable nginx
sudo nginx -t
curl http://localhost

# –ü—Ä–æ–≤–µ—Ä–∏–º –º–µ—Ç–∫–∏
sudo cat /etc/yandex-cloud/labels.json

ssh -i ~/.ssh/terraform_rsa ubuntu@46.21.244.161
ssh -i ~/.ssh/terraform_rsa ubuntu@89.169.141.0

#ssh -i ~/.ssh/yandex_cloud ubuntu@89.169.141.0
#ssh -i ~/.ssh/yandex_cloud ubuntu@46.21.244.161
======================================================




#2.3 –ú–æ–¥—É–ª—å –¥–æ–ª–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –≤ root module —Å –ø–æ–º–æ—â—å—é output –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ yandex_vpc_subnet. –ü—Ä–∏—à–ª–∏—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏–∑ terraform console –æ —Å–≤–æ–µ–º –º–æ–¥—É–ª–µ. –ü—Ä–∏–º–µ—Ä: > module.vpc_dev  

--------------------------
terraform apply -auto-approve -lock=false



nano modules/vpc/outputs.tf
–î–æ–±–∞–≤–∏–º –ø–æ–ª–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–¥—Å–µ—Ç–∏:

# modules/vpc/outputs.tf

output "network_id" {
  description = "ID of the created VPC network"
  value       = yandex_vpc_network.network.id
}

output "subnet_id" {
  description = "ID of the created subnet"
  value       = yandex_vpc_subnet.subnet.id
}

output "network_name" {
  description = "Name of the created VPC network"
  value       = yandex_vpc_network.network.name
}

output "subnet_name" {
  description = "Name of the created subnet"
  value       = yandex_vpc_subnet.subnet.name
}

output "subnet_cidr_blocks" {
  description = "CIDR blocks of the created subnet"
  value       = yandex_vpc_subnet.subnet.v4_cidr_blocks
}

output "zone" {
  description = "Availability zone of the subnet"
  value       = yandex_vpc_subnet.subnet.zone
}

# –ü–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–¥—Å–µ—Ç–∏
output "subnet_info" {
  description = "Complete information about the subnet"
  value = {
    id           = yandex_vpc_subnet.subnet.id
    name         = yandex_vpc_subnet.subnet.name
    zone         = yandex_vpc_subnet.subnet.zone
    network_id   = yandex_vpc_subnet.subnet.network_id
    v4_cidr_blocks = yandex_vpc_subnet.subnet.v4_cidr_blocks
    created_at   = yandex_vpc_subnet.subnet.created_at
  }
}

# –ü–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ—Ç–∏
output "network_info" {
  description = "Complete information about the network"
  value = {
    id      = yandex_vpc_network.network.id
    name    = yandex_vpc_network.network.name
    created_at = yandex_vpc_network.network.created_at
  }
}
üöÄ –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
terraform apply -auto-approve -lock=false

–í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–æ–¥—É–ª–µ:
> module.vpc

–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–¥—Å–µ—Ç–∏: 
> module.vpc.subnet_info

–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ—Ç–∏: 
> module.vpc.network_info

–û—Ç–¥–µ–ª—å–Ω—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã –ø–æ–¥—Å–µ—Ç–∏:
> module.vpc.subnet_id
> module.vpc.subnet_name
> module.vpc.zone
> module.vpc.subnet_cidr_blocks

–ü–µ—Ä–µ–¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:
> module.vpc.network_name


==================================


#2.4 –ó–∞–º–µ–Ω–∏—Ç–µ —Ä–µ—Å—É—Ä—Å—ã yandex_vpc_network –∏ yandex_vpc_subnet —Å–æ–∑–¥–∞–Ω–Ω—ã–º –º–æ–¥—É–ª–µ–º. –ù–µ –∑–∞–±—É–¥—å—Ç–µ –ø–µ—Ä–µ–¥–∞—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–µ—Ç–∏ –∏–∑ –º–æ–¥—É–ª—è vpc –≤ –º–æ–¥—É–ª—å —Å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–æ–π.


----------------

–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ main.tf
nano main.tf

# main.tf

terraform {
  required_version = ">= 1.0"
  required_providers {
    yandex = {
      source  = "yandex-cloud/yandex"
      version = ">= 0.171.0"
    }
  }
}

provider "yandex" {
  token     = var.yc_token
  cloud_id  = var.yc_cloud_id
  folder_id = var.yc_folder_id
  zone      = "ru-central1-a"
}

# –ú–æ–¥—É–ª—å VPC (–∑–∞–º–µ–Ω—è–µ—Ç –ø—Ä—è–º—ã–µ —Ä–µ—Å—É—Ä—Å—ã yandex_vpc_network –∏ yandex_vpc_subnet)
module "vpc" {
  source = "./modules/vpc"

  # –ü–µ—Ä–µ–¥–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–µ—Ç–∏
  network_name = "production-network"
  subnet_name  = "production-subnet"
  zone         = "ru-central1-a"
  cidr_blocks  = "192.168.100.0/24"
}

# –ú–æ–¥—É–ª—å marketing_vm —Å –ø–µ—Ä–µ–¥–∞—á–µ–π –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏–∑ –º–æ–¥—É–ª—è VPC
module "marketing_vm" {
  source = "./modules/marketing_vm"

  # –ü–µ—Ä–µ–¥–∞–µ–º subnet_id –∏–∑ –º–æ–¥—É–ª—è VPC
  subnet_id      = module.vpc.subnet_id
  ssh_public_key = var.vms_ssh_root_key
  zone           = module.vpc.zone  # –ø–µ—Ä–µ–¥–∞–µ–º zone –∏–∑ –º–æ–¥—É–ª—è VPC
}

# –†–µ—Å—É—Ä—Å analytics_vm —Å –ø–µ—Ä–µ–¥–∞—á–µ–π –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏–∑ –º–æ–¥—É–ª—è VPC
resource "yandex_compute_instance" "analytics_vm" {
  name        = "analytics-vm"
  platform_id = "standard-v3"
  zone        = module.vpc.zone  # –∏—Å–ø–æ–ª—å–∑—É–µ–º zone –∏–∑ –º–æ–¥—É–ª—è VPC

  allow_stopping_for_update = true

  resources {
    cores  = 2
    memory = 2
  }

  boot_disk {
    initialize_params {
      image_id = "fd84nt41ssoaapgql97p"
      size     = 20
    }
  }

  network_interface {
    subnet_id = module.vpc.subnet_id  # –∏—Å–ø–æ–ª—å–∑—É–µ–º subnet_id –∏–∑ –º–æ–¥—É–ª—è VPC
    nat       = true
  }

  metadata = {
    ssh-keys = "ubuntu:${var.vms_ssh_root_key}"
  }

  labels = {
    environment = "analytics"
    owner       = "analytics-team"
    project     = "terraform"
  }
}

# –í—ã–≤–æ–¥ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
output "marketing_vm_ip" {
  description = "External IP address of the marketing VM"
  value       = module.marketing_vm.external_ip
}

output "analytics_vm_ip" {
  description = "External IP address of the analytics VM"
  value       = yandex_compute_instance.analytics_vm.network_interface[0].nat_ip_address
}


------------

–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ outputs.tf

nano outputs.tf

# outputs.tf

output "marketing_vm_ip" {
  description = "External IP address of the marketing VM"
  value       = module.marketing_vm.external_ip
}

output "marketing_vm_internal_ip" {
  description = "Internal IP address of the marketing VM"
  value       = module.marketing_vm.internal_ip
}

output "analytics_vm_ip" {
  description = "External IP address of the analytics VM"
  value       = yandex_compute_instance.analytics_vm.network_interface[0].nat_ip_address
}

output "marketing_vm_info" {
  description = "Complete information about marketing VM"
  value = {
    name        = module.marketing_vm.name
    external_ip = module.marketing_vm.external_ip
    internal_ip = module.marketing_vm.internal_ip
  }
}

output "vpc_network_info" {
  description = "Information about VPC network"
  value = {
    network_id    = module.vpc.network_id
    subnet_id     = module.vpc.subnet_id
    network_name  = module.vpc.network_name
    subnet_name   = module.vpc.subnet_name
    cidr_blocks   = module.vpc.subnet_cidr_blocks
    zone          = module.vpc.zone
  }
}

output "subnet_complete_info" {
  description = "Complete information about subnet from VPC module"
  value       = module.vpc.subnet_info
}

output "ssh_connection_commands" {
  description = "SSH connection commands for VMs"
  value = {
    marketing = "ssh -i ~/.ssh/terraform_rsa ubuntu@${module.marketing_vm.external_ip}"
    analytics = "ssh -i ~/.ssh/terraform_rsa ubuntu@${yandex_compute_instance.analytics_vm.network_interface[0].nat_ip_address}"
  }
}

------------




# –£–¥–∞–ª–∏–º —Å—Ç–∞—Ä—ã–µ —Ä–µ—Å—É—Ä—Å—ã —Å–µ—Ç–∏ –∏–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è
terraform state rm yandex_vpc_network.network yandex_vpc_subnet.subnet

# –ü—Ä–∏–º–µ–Ω–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
terraform apply -auto-approve -lock=false

 –ü—Ä–æ–≤–µ—Ä–∏–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
terraform validate

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: Success! The configuration is valid.

# –ü—Ä–∏–º–µ–Ω–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
terraform apply -auto-approve -lock=false



terraform console

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–¥—É–ª—è VPC
> module.vpc

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –≤—Å–µ –∞—Ç—Ä–∏–±—É—Ç—ã –¥–æ—Å—Ç—É–ø–Ω—ã
> module.marketing_vm.name
> module.marketing_vm.external_ip
> module.marketing_vm.internal_ip
> module.marketing_vm.instance_id

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–¥—Å–µ—Ç–∏
> module.vpc.subnet_info
üìã –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
terraform output

===========================



#2.5. –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –∫ –º–æ–¥—É–ª—é —Å –ø–æ–º–æ—â—å—é terraform-docs

----------------------
–£—Å—Ç–∞–Ω–æ–≤–∫–∞ terraform-docs


# –°–∫–∞—á–∞–µ–º –∏ —É—Å—Ç–∞–Ω–æ–≤–∏–º terraform-docs
curl -Lo ./terraform-docs.tar.gz https://github.com/terraform-docs/terraform-docs/releases/download/v0.16.0/terraform-docs-v0.16.0-linux-amd64.tar.gz
tar -xzf terraform-docs.tar.gz
sudo mv terraform-docs /usr/local/bin/
rm terraform-docs.tar.gz

# –ü—Ä–æ–≤–µ—Ä–∏–º —É—Å—Ç–∞–Ω–æ–≤–∫—É
terraform-docs --version

–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –¥–ª—è –º–æ–¥—É–ª—è VPC
# –ü–µ—Ä–µ–π–¥–µ–º –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –º–æ–¥—É–ª—è VPC
cd modules/vpc

# –°–≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –≤ —Ñ–æ—Ä–º–∞—Ç–µ markdown
terraform-docs markdown table --output-file README.md .

# –ü–æ—Å–º–æ—Ç—Ä–∏–º —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
cat README.md

# –ù–∞—Ö–æ–¥—è—Å—å –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ modules/vpc
terraform-docs markdown table --output-file README.md .

# –ò–ª–∏ –∏–∑ –∫–æ—Ä–Ω–µ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
cd ~/terraform-project
terraform-docs markdown table --output-file modules/vpc/README.md modules/vpc/

# –°–≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –¥–ª—è –º–æ–¥—É–ª—è VPC
terraform-docs markdown table --output-file modules/vpc/README.md modules/vpc/

# –ü–æ—Å–º–æ—Ç—Ä–∏–º —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
cat modules/vpc/README.md


# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–µ–∫—É—â—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
pwd

# –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —Ñ–∞–π–ª—ã –≤ —Ç–µ–∫—É—â–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
ls -la

# –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ README.md
cat README.md

# –ò–õ–ò —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –ø–æ–ª–Ω–æ–≥–æ –ø—É—Ç–∏
cat ~/terraform-project/modules/vpc/README.md

=================================



### –ó–∞–¥–∞–Ω–∏–µ 3
1. –í—ã–≤–µ–¥–∏—Ç–µ —Å–ø–∏—Å–æ–∫ —Ä–µ—Å—É—Ä—Å–æ–≤ –≤ —Å—Ç–µ–π—Ç–µ.
2. –ü–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–∏—Ç–µ –∏–∑ —Å—Ç–µ–π—Ç–∞ –º–æ–¥—É–ª—å vpc.
3. –ü–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–∏—Ç–µ –∏–∑ —Å—Ç–µ–π—Ç–∞ –º–æ–¥—É–ª—å vm.
4. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –≤—Å—ë –æ–±—Ä–∞—Ç–Ω–æ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ terraform plan. –ó–Ω–∞—á–∏–º—ã—Ö(!!) –∏–∑–º–µ–Ω–µ–Ω–∏–π –±—ã—Ç—å –Ω–µ –¥–æ–ª–∂–Ω–æ.
–ü—Ä–∏–ª–æ–∂–∏—Ç–µ —Å–ø–∏—Å–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∫–æ–º–∞–Ω–¥ –∏ —Å–∫—Ä–∏–Ω—à–æ—Ç—ã –ø—Ä–æ—Ü–µ—Å—Å—ã.

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è (—Å–æ –∑–≤—ë–∑–¥–æ—á–∫–æ–π*)

**–ù–∞—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º –≤—ã–ø–æ–ª–Ω—è—Ç—å –≤—Å–µ –∑–∞–¥–∞–Ω–∏—è —Å–æ –∑–≤—ë–∑–¥–æ—á–∫–æ–π.**   –û–Ω–∏ –ø–æ–º–æ–≥—É—Ç –≥–ª—É–±–∂–µ —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è –≤ –º–∞—Ç–µ—Ä–∏–∞–ª–µ.   
–ó–∞–¥–∞–Ω–∏—è —Å–æ –∑–≤—ë–∑–¥–æ—á–∫–æ–π –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ, –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é –∏ –Ω–∏–∫–∞–∫ –Ω–µ –ø–æ–≤–ª–∏—è—é—Ç –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ –≤–∞–º–∏ –∑–∞—á—ë—Ç–∞ –ø–æ —ç—Ç–æ–º—É –¥–æ–º–∞—à–Ω–µ–º—É –∑–∞–¥–∞–Ω–∏—é. 

-----------------------
#3.1 –í—ã–≤–µ–¥–∏—Ç–µ —Å–ø–∏—Å–æ–∫ —Ä–µ—Å—É—Ä—Å–æ–≤ –≤ —Å—Ç–µ–π—Ç–µ

----------

–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ä–µ—Å—É—Ä—Å–æ–≤ –≤ —Å—Ç–µ–π—Ç–µ:

# –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —Ä–µ—Å—É—Ä—Å—ã –≤ —Å—Ç–µ–π—Ç–µ
terraform state list

# –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤—Å–µ—Ö —Ä–µ—Å—É—Ä—Å–∞—Ö
terraform show

# –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–µ–π—Ç –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ
terraform show -json

# –ë–æ–ª–µ–µ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:
# –ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ—Å—É—Ä—Å—ã –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞
terraform state list | grep <—Ç–∏–ø_—Ä–µ—Å—É—Ä—Å–∞>

# –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º —Ä–µ—Å—É—Ä—Å–µ
terraform state show <–ø–æ–ª–Ω—ã–π_–∞–¥—Ä–µ—Å_—Ä–µ—Å—É—Ä—Å–∞>

terraform state show aws_instance.web_server

# –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:
# –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç–µ–∫—É—â–∏–π —Å—Ç–µ–π—Ç —Ñ–∞–π–ª
terraform state pull

# –ü–æ–∫–∞–∑–∞—Ç—å –≤–µ—Ä—Å–∏—é —Å—Ç–µ–π—Ç–∞
terraform version

# –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é —Å Terraform –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
cd ~/terraform-project

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ Terraform (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —Å–¥–µ–ª–∞–Ω–æ)
terraform init

# –í—ã–≤–µ–¥–∏—Ç–µ —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ä–µ—Å—É—Ä—Å–æ–≤
terraform state list


# –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –∫–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞
cd ~/terraform-project/

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Terraform
terraform init

# –ü–ª–∞–Ω–∏—Ä—É–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
terraform plan

# –ü—Ä–∏–º–µ–Ω—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é (—Å–æ–∑–¥–∞–µ–º —Ä–µ—Å—É—Ä—Å—ã)
terraform apply

# –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ —Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç–µ–π—Ç
terraform state list
terraform show
=====================================


#3.2 –ü–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–∏—Ç–µ –∏–∑ —Å—Ç–µ–π—Ç–∞ –º–æ–¥—É–ª—å vpc.



------------------
# –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –∫–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞
cd ~/terraform-project/

# –ù–∞–π–¥–∏—Ç–µ –≤—Å–µ —Ä–µ—Å—É—Ä—Å—ã –º–æ–¥—É–ª—è vpc
terraform state list | grep module.vpc
2. –£–¥–∞–ª–∏—Ç–µ –≤–µ—Å—å –º–æ–¥—É–ª—å –∏–∑ —Å—Ç–µ–π—Ç–∞
bash
# –£–¥–∞–ª–∏—Ç—å –≤–µ—Å—å –º–æ–¥—É–ª—å vpc –∏–∑ —Å—Ç–µ–π—Ç–∞
terraform state rm module.vpc








3.3 –ü–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–∏—Ç–µ –∏–∑ —Å—Ç–µ–π—Ç–∞ –º–æ–¥—É–ª—å vm.

–ü—Ä–æ–≤–µ—Ä–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –º–æ–¥—É–ª—è VPC
# –ü—Ä–æ–≤–µ—Ä–∏–º, —á—Ç–æ –º–æ–¥—É–ª—å VPC –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω
terraform state list | grep module.vpc

# –ü–æ—Å–º–æ—Ç—Ä–∏–º –æ–±—â–∏–π —Å–ø–∏—Å–æ–∫ —Ä–µ—Å—É—Ä—Å–æ–≤ –≤ —Å—Ç–µ–π—Ç–µ
terraform state list

# –ü–æ—Å–º–æ—Ç—Ä–∏–º –≤—Å–µ –º–æ–¥—É–ª–∏ –≤ —Å—Ç–µ–π—Ç–µ
terraform state list | grep module.

# –ò–ª–∏ –ø–æ—Å–º–æ—Ç—Ä–∏–º –≤—Å–µ —Ä–µ—Å—É—Ä—Å—ã —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É
terraform state list

–£–¥–∞–ª—è–µ–º –º–æ–¥—É–ª—å marketing_vm
terraform state rm module.marketing_vm

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –≤—Å–µ VM —Ä–µ—Å—É—Ä—Å—ã:
# –£–¥–∞–ª—è–µ–º –º–æ–¥—É–ª—å marketing_vm
terraform state rm module.marketing_vm

# –£–¥–∞–ª—è–µ–º –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ä–µ—Å—É—Ä—Å analytics_vm
terraform state rm yandex_compute_instance.analytics_vm

–ò–ª–∏ –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π —É–¥–∞–ª–∏—Ç—å –≤—Å–µ:
# –£–¥–∞–ª—è–µ–º –≤—Å–µ —Ä–µ—Å—É—Ä—Å—ã –∏–∑ —Å—Ç–µ–π—Ç–∞
terraform state rm module.marketing_vm yandex_compute_instance.analytics_vm

–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:
# –ü–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä—è–µ–º
terraform state list
# –£–¥–∞–ª—è–µ–º –æ—Å—Ç–∞–≤—à–∏–π—Å—è —Ä–µ—Å—É—Ä—Å analytics_vm
terraform state rm yandex_compute_instance.analytics_vm

===============================



#3.4 –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –≤—Å—ë –æ–±—Ä–∞—Ç–Ω–æ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ terraform plan. –ó–Ω–∞—á–∏–º—ã—Ö(!!) –∏–∑–º–µ–Ω–µ–Ω–∏–π –±—ã—Ç—å –Ω–µ –¥–æ–ª–∂–Ω–æ.

-----------

1. –°–Ω–∞—á–∞–ª–∞ —É–∑–Ω–∞–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ä–µ—Å—É—Ä—Å–æ–≤ –∏–∑ –∫–æ–¥–∞:
# –ü–æ—Å–º–æ—Ç—Ä–∏–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ä–µ—Å—É—Ä—Å–æ–≤
cat main.tf
cat modules/vpc/main.tf
cat modules/marketing_vm/main.tf

2. –ò–º–ø–æ—Ä—Ç —Ä–µ—Å—É—Ä—Å–æ–≤ VPC –º–æ–¥—É–ª—è:
# –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º VPC —Å–µ—Ç—å
terraform import module.vpc.yandex_vpc_network.network <–∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä_—Å–µ—Ç–∏>

# –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ–¥—Å–µ—Ç–∏
terraform import module.vpc.yandex_vpc_subnet.subnet <–∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä_–ø–æ–¥—Å–µ—Ç–∏>

3. –ò–º–ø–æ—Ä—Ç –º–æ–¥—É–ª—è marketing_vm:
# –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º VM –∏–∑ –º–æ–¥—É–ª—è
terraform import module.marketing_vm.yandex_compute_instance.marketing_vm <–∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä_–≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π_–º–∞—à–∏–Ω—ã>

4. –ò–º–ø–æ—Ä—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–π VM:
# –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –æ—Ç–¥–µ–ª—å–Ω—É—é VM
terraform import yandex_compute_instance.analytics_vm <–∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä_–≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π_–º–∞—à–∏–Ω—ã>

5. –ü—Ä–æ–≤–µ—Ä–∫–∞:
# –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –≤—Å–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ
terraform state list

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –Ω–µ—Ç –∑–Ω–∞—á–∏–º—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
terraform plan


–ò–º–ø–æ—Ä—Ç —Ä–µ—Å—É—Ä—Å–æ–≤:
# 1. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º VPC —Å–µ—Ç—å
terraform import module.vpc.yandex_vpc_network.network enp8he3d37dhk5tnvjri

# 2. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ–¥—Å–µ—Ç—å
terraform import module.vpc.yandex_vpc_subnet.subnet e9bjp84lpfvg2ls15dub

# 3. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º VM –∏–∑ –º–æ–¥—É–ª—è marketing_vm (–Ω—É–∂–µ–Ω ID marketing VM)
terraform import module.marketing_vm.yandex_compute_instance.marketing_vm fhm0qeo8sblurjj868c4

# 4. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –æ—Ç–¥–µ–ª—å–Ω—É—é analytics VM (–Ω—É–∂–µ–Ω ID analytics VM)
terraform import yandex_compute_instance.analytics_vm fhmuor61p09homf0v7tg

# –ü–æ–ª—É—á–∏–º —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö VM –∏ –∏—Ö –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤
yc compute instance list

# –ò–ª–∏ –Ω–∞–π–¥–µ–º –ø–æ –∏–º–µ–Ω–∏
yc compute instance get --name marketing-vm
yc compute instance get --name analytics-vm

# –ü—Ä–æ–≤–µ—Ä–∏–º —á—Ç–æ –≤—Å–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ
terraform state list

# –ü—Ä–æ–≤–µ—Ä–∏–º —á—Ç–æ –Ω–µ—Ç –∑–Ω–∞—á–∏–º—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
terraform plan



=================================



### –ó–∞–¥–∞–Ω–∏–µ 4*

1. –ò–∑–º–µ–Ω–∏—Ç–µ –º–æ–¥—É–ª—å vpc —Ç–∞–∫, —á—Ç–æ–±—ã –æ–Ω –º–æ–≥ —Å–æ–∑–¥–∞—Ç—å –ø–æ–¥—Å–µ—Ç–∏ –≤–æ –≤—Å–µ—Ö –∑–æ–Ω–∞—Ö –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏, –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã—Ö –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π —Ç–∏–ø–∞ list(object) –ø—Ä–∏ –≤—ã–∑–æ–≤–µ –º–æ–¥—É–ª—è.  
  
–ü—Ä–∏–º–µ—Ä –≤—ã–∑–æ–≤–∞
```
module "vpc_prod" {
  source       = "./vpc"
  env_name     = "production"
  subnets = [
    { zone = "ru-central1-a", cidr = "10.0.1.0/24" },
    { zone = "ru-central1-b", cidr = "10.0.2.0/24" },
    { zone = "ru-central1-c", cidr = "10.0.3.0/24" },
  ]
}

module "vpc_dev" {
  source       = "./vpc"
  env_name     = "develop"
  subnets = [
    { zone = "ru-central1-a", cidr = "10.0.1.0/24" },
  ]
}
```

–ü—Ä–µ–¥–æ—Å—Ç–∞–≤—å—Ç–µ –∫–æ–¥, –ø–ª–∞–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏–∑ –∫–æ–Ω—Å–æ–ª–∏ YC.

------------------------


1. –°–æ–∑–¥–∞–¥–∏–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –º–æ–¥—É–ª—è VPC
bash
# –°–æ–∑–¥–∞–¥–∏–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –º–æ–¥—É–ª—è
mkdir -p modules/vpc

# –°–æ–∑–¥–∞–¥–∏–º variables.tf –¥–ª—è –º–æ–¥—É–ª—è vpc
cat > modules/vpc/variables.tf << 'EOF'
variable "env_name" {
  type        = string
  description = "Environment name"
}

variable "subnets" {
  type = list(object({
    zone = string
    cidr = string
  }))
  description = "List of subnets to create in different availability zones"
}
EOF

# –°–æ–∑–¥–∞–¥–∏–º main.tf –¥–ª—è –º–æ–¥—É–ª—è vpc
cat > modules/vpc/main.tf << 'EOF'
resource "yandex_vpc_network" "network" {
  name = "${var.env_name}-network"
}

resource "yandex_vpc_subnet" "subnets" {
  count = length(var.subnets)

  name           = "${var.env_name}-subnet-${var.subnets[count.index].zone}"
  zone           = var.subnets[count.index].zone
  network_id     = yandex_vpc_network.network.id
  v4_cidr_blocks = [var.subnets[count.index].cidr]
}
EOF

# –°–æ–∑–¥–∞–¥–∏–º outputs.tf –¥–ª—è –º–æ–¥—É–ª—è vpc
cat > modules/vpc/outputs.tf << 'EOF'
output "network_id" {
  value = yandex_vpc_network.network.id
}

output "network_name" {
  value = yandex_vpc_network.network.name
}

output "subnet_ids" {
  value = { for idx, subnet in yandex_vpc_subnet.subnets : var.subnets[idx].zone => subnet.id }
}

output "subnets" {
  value = { for idx, subnet in yandex_vpc_subnet.subnets : var.subnets[idx].zone => {
    id             = subnet.id
    name           = subnet.name
    zone           = subnet.zone
    v4_cidr_blocks = subnet.v4_cidr_blocks
  } }
}
EOF


chmod +x test_module_workflow.sh
./test_module_workflow.sh


 chmod +x check_assignment.sh
./check_assignment.sh




















=========================
========================






---
1. –°–Ω–∞—á–∞–ª–∞ –∏–∑–º–µ–Ω–∏–º —Ñ–∞–π–ª –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –º–æ–¥—É–ª—è VPC
–°–æ–∑–¥–∞–π—Ç–µ –∏–ª–∏ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ modules/vpc/variables.tf:

hcl
variable "env_name" {
  type        = string
  description = "Environment name"
}

variable "subnets" {
  type = list(object({
    zone = string
    cidr = string
  }))
  description = "List of subnets to create"
}
2. –ò–∑–º–µ–Ω–∏–º –æ—Å–Ω–æ–≤–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –º–æ–¥—É–ª—è VPC
–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ modules/vpc/main.tf:

hcl
# –°–æ–∑–¥–∞–Ω–∏–µ VPC —Å–µ—Ç–∏
resource "yandex_vpc_network" "network" {
  name = "${var.env_name}-network"
}

# –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–¥—Å–µ—Ç–µ–π –≤ —Ä–∞–∑–Ω—ã—Ö –∑–æ–Ω–∞—Ö –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
resource "yandex_vpc_subnet" "subnets" {
  count = length(var.subnets)

  name           = "${var.env_name}-subnet-${var.subnets[count.index].zone}"
  zone           = var.subnets[count.index].zone
  network_id     = yandex_vpc_network.network.id
  v4_cidr_blocks = [var.subnets[count.index].cidr]
}
3. –û–±–Ω–æ–≤–∏–º outputs –º–æ–¥—É–ª—è VPC
–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ modules/vpc/outputs.tf:

hcl
output "network_id" {
  value = yandex_vpc_network.network.id
}

output "network_name" {
  value = yandex_vpc_network.network.name
}

output "subnet_ids" {
  value = { for idx, subnet in yandex_vpc_subnet.subnets : var.subnets[idx].zone => subnet.id }
}

output "subnets" {
  value = { for idx, subnet in yandex_vpc_subnet.subnets : var.subnets[idx].zone => {
    id             = subnet.id
    name           = subnet.name
    zone           = subnet.zone
    v4_cidr_blocks = subnet.v4_cidr_blocks
  } }
}
4. –¢–µ–ø–µ—Ä—å –æ–±–Ω–æ–≤–∏–º –∫–æ—Ä–Ω–µ–≤–æ–π main.tf
–ò–∑–º–µ–Ω–∏—Ç–µ –≤–∞—à main.tf –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

hcl
# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ Yandex.Cloud
provider "yandex" {
  token     = var.yc_token
  cloud_id  = var.yc_cloud_id
  folder_id = var.yc_folder_id
  zone      = "ru-central1-a"
}

# –ú–æ–¥—É–ª—å VPC –¥–ª—è production
module "vpc" {
  source   = "./modules/vpc"
  env_name = "production"

  subnets = [
    { zone = "ru-central1-a", cidr = "192.168.100.0/24" }
  ]
}

# –í—ã–∑–æ–≤ –º–æ–¥—É–ª—è marketing_vm
module "marketing_vm" {
  source = "./modules/marketing_vm"

  # –ü–µ—Ä–µ–¥–∞—á–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ –º–æ–¥—É–ª—å
  subnet_id      = module.vpc.subnet_ids["ru-central1-a"] # –¢–µ–ø–µ—Ä—å –±–µ—Ä–µ–º –ø–æ –∑–æ–Ω–µ
  ssh_public_key = var.vms_ssh_root_key
  zone           = "ru-central1-a"
}
5. –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –¥–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∑–æ–Ω (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ)
–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ —Å–æ–∑–¥–∞—Ç—å –ø–æ–¥—Å–µ—Ç–∏ –≤–æ –≤—Å–µ—Ö –∑–æ–Ω–∞—Ö, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–∞–∫—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:

hcl
# –ú–æ–¥—É–ª—å VPC –¥–ª—è production –≤–æ –≤—Å–µ—Ö –∑–æ–Ω–∞—Ö
module "vpc_prod" {
  source   = "./modules/vpc"
  env_name = "production"

  subnets = [
    { zone = "ru-central1-a", cidr = "10.0.1.0/24" },
    { zone = "ru-central1-b", cidr = "10.0.2.0/24" },
    { zone = "ru-central1-c", cidr = "10.0.3.0/24" },
  ]
}

# –ú–æ–¥—É–ª—å VPC –¥–ª—è development –≤ –æ–¥–Ω–æ–π –∑–æ–Ω–µ
module "vpc_dev" {
  source   = "./modules/vpc"
  env_name = "develop"

  subnets = [
    { zone = "ru-central1-a", cidr = "10.10.1.0/24" },
  ]
}
6. –û–±–Ω–æ–≤–∏—Ç–µ –º–æ–¥—É–ª—å marketing_vm
–í modules/marketing_vm/main.tf —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è subnet_id –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:

hcl
variable "subnet_id" {
  type        = string
  description = "Subnet ID for the VM"
}

resource "yandex_compute_instance" "marketing_vm" {
  # ... –æ—Å—Ç–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
  network_interface {
    subnet_id = var.subnet_id
    # ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
  }
}
–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
bash
# –ü—Ä–æ–≤–µ—Ä–∏–º —Å–∏–Ω—Ç–∞–∫—Å–∏—Å
terraform validate

# –ü–æ—Å–º–æ—Ç—Ä–∏–º –ø–ª–∞–Ω
terraform plan
–¢–µ–ø–µ—Ä—å –º–æ–¥—É–ª—å VPC –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø–æ–¥—Å–µ—Ç–∏ –≤ –ª—é–±–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –∑–æ–Ω –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏, –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã—Ö –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π subnets!


ls -la modules/marketing_vm/

# –°–æ–∑–¥–∞–µ–º —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é
 cp main.tf main.tf.backup

# –ü–æ—Å–º–æ—Ç—Ä–∏–º –∫–∞–∫–∏–µ —Ñ–∞–π–ª—ã –µ—Å—Ç—å –≤ –º–æ–¥—É–ª–µ marketing_vm
ls -la modules/marketing_vm/

# –ü–æ—Å–º–æ—Ç—Ä–∏–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ variables.tf –µ—Å–ª–∏ –æ–Ω —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
cat modules/marketing_vm/variables.tf 2>/dev/null || echo "File not found"


# –ü—Ä–æ–≤–µ—Ä–∏–º main.tf –º–æ–¥—É–ª—è marketing_vm 
cat modules/marketing_vm/main.tf



# –ü—Ä–æ–≤–µ—Ä–∏–º –≤—ã–∑–æ–≤ –º–æ–¥—É–ª—è marketing_vm –≤ –æ—Å–Ω–æ–≤–Ω–æ–º main.tf
cat main.tf | grep -A 10 'module "marketing_vm"'


# –ü–æ—Å–º–æ—Ç—Ä–∏–º —á—Ç–æ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –º–æ–¥—É–ª–µ marketing_vm 
ls -la modules/marketing_vm/

# –£–¥–∞–ª—è–µ–º —Ñ–∞–π–ª variables.tf
rm modules/marketing_vm/variables.tf

# –ü—Ä–æ–≤–µ—Ä–∏–º —á—Ç–æ –≤ main.tf –µ—Å—Ç—å –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
cat modules/marketing_vm/main.tf


# –ü—Ä–æ–≤–µ—Ä–∏–º –≤—Å–µ —Ñ–∞–π–ª—ã –≤ –º–æ–¥—É–ª–µ marketing_vm
find modules/marketing_vm/ -name "*.tf" -exec echo "=== {} ===" \; -exec cat {} \;



# –£–¥–∞–ª–∏–º –∫—ç—à –∏ –ø–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º
rm -rf .terraform
terraform init


# –£–¥–∞–ª–∏–º —Ñ–∞–π–ª—ã —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –∏–º–µ–Ω–∞–º–∏
rm -f 'outputs.tf\' 'outputs.tf\Y' 'y'

# –ü—Ä–æ–≤–µ—Ä–∏–º —á—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å
ls -la

# –£–¥–∞–ª—è–µ–º –≤—Å–µ –∫—ç—à–∏ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è
rm -rf .terraform* terraform.tfstate*

# –ü—Ä–æ–≤–µ—Ä–∏–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
cat main.tf
cat variables.tf
# –£–¥–∞–ª—è–µ–º –≤—Å–µ –∫—ç—à–∏ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è
rm -rf .terraform* terraform.tfstate*

# –ü—Ä–æ–≤–µ—Ä–∏–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
cat main.tf
cat variables.tf

# –ò—â–µ–º –≤—Å–µ —Ñ–∞–π–ª—ã —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å Terraform
find . -name "*terraform*" -type f
find . -name "*.tf" -type f

# –ò—â–µ–º —É–ø–æ–º–∏–Ω–∞–Ω–∏—è hashicorp –≤–æ –≤—Å–µ—Ö tf —Ñ–∞–π–ª–∞—Ö
grep -r "hashicorp" . --include="*.tf" || echo "No hashicorp references found"

# –ü—Ä–æ–≤–µ—Ä–∏–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å registry
curl -I https://registry.terraform.io/
ping registry.terraform.io



# –°–æ–∑–¥–∞–¥–∏–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –ø–ª–∞–≥–∏–Ω–æ–≤
mkdir -p ~/.terraform.d/plugins/registry.terraform.io/yandex-cloud/yandex/0.171.0/linux_amd64

# –°–∫–∞—á–∞–µ–º –ø—Ä–æ–≤–∞–π–¥–µ—Ä
cd ~/.terraform.d/plugins/registry.terraform.io/yandex-cloud/yandex/0.171.0/linux_amd64
wget https://storage.yandexcloud.net/tf-providers/yandex-provider_0.171.0_linux_amd64.zip
unzip yandex-provider_0.171.0_linux_amd64.zip
rm yandex-provider_0.171.0_linux_amd64.zip

# –í–µ—Ä–Ω–µ–º—Å—è –≤ –ø—Ä–æ–µ–∫—Ç
cd ~/terraform-project


–°–∫–∞—á–∞–µ–º –ø—Ä–æ–≤–∞–π–¥–µ—Ä —Å GitHub Releases
bash
# –í–µ—Ä–Ω–µ–º—Å—è –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø–ª–∞–≥–∏–Ω–æ–≤
cd ~/.terraform.d/plugins/registry.terraform.io/yandex-cloud/yandex/0.171.0/linux_amd64

# –°–∫–∞—á–∞–µ–º –ø—Ä–æ–≤–∞–π–¥–µ—Ä —Å GitHub
wget https://github.com/yandex-cloud/terraform-provider-yandex/releases/download/v0.171.0/terraform-provider-yandex_0.171.0_linux_amd64.zip

# –†–∞—Å–ø–∞–∫—É–µ–º
unzip terraform-provider-yandex_0.171.0_linux_amd64.zip
rm terraform-provider-yandex_0.171.0_linux_amd64.zip

# –í–µ—Ä–Ω–µ–º—Å—è –≤ –ø—Ä–æ–µ–∫—Ç
cd ~/terraform-project



–ü—Ä–æ–≤–µ—Ä–∏–º —á—Ç–æ —Ñ–∞–π–ª —Å–∫–∞—á–∞–ª—Å—è

ls -la ~/.terraform.d/plugins/registry.terraform.io/yandex-cloud/yandex/0.171.0/linux_amd64/


–ù–∞—Å—Ç—Ä–æ–∏–º —Ñ–∞–π–ª–æ–≤–æ–µ –∑–µ—Ä–∫–∞–ª–æ
bash
# –°–æ–∑–¥–∞–µ–º .terraformrc
cat > ~/.terraformrc << 'EOF'
provider_installation {
  filesystem_mirror {
    path    = "/home/alexlinux/.terraform.d/plugins"
    include = ["yandex-cloud/yandex"]
  }
  direct {
    exclude = ["yandex-cloud/yandex"]
  }
}
EOF


–ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ä–µ—Å—É—Ä—Å—ã –≤ —Å—Ç–µ–π—Ç
bash
# –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Å–µ—Ç—å
terraform import yandex_vpc_network.production enp8he3d37dhk5tnvjri

# –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ–¥—Å–µ—Ç—å
terraform import yandex_vpc_subnet.production e9bjp84lpfvg2ls15dub

# –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –º–∞—à–∏–Ω—ã
terraform import yandex_compute_instance.marketing_vm fhm0qeo8sblurjj868c4
terraform import yandex_compute_instance.analytics_vm fhmuor61p09homf0v7tg

# –ü–æ–ª—É—á–∏–º –ø–æ–¥—Ä–æ–±–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ VM
yc compute instance get fhm0qeo8sblurjj868c4
yc compute instance get fhmuor61p09homf0v7tg


–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–º –º–∞—à–∏–Ω–∞–º

# –ü—Ä–æ–≤–µ—Ä–∏–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ marketing VM
ssh -i ~/.ssh/terraform_rsa ubuntu@89.169.129.156

# –ü—Ä–æ–≤–µ—Ä–∏–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ analytics VM  
ssh -i ~/.ssh/terraform_rsa ubuntu@51.250.87.56

–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π

git init
git config user.name "sapr797"
git config user.email "unisapr797@gmail.com"  # –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à email





=========================





























### –ó–∞–¥–∞–Ω–∏–µ 5*

1. –ù–∞–ø–∏—à–∏—Ç–µ –º–æ–¥—É–ª—å –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª–∞—Å—Ç–µ—Ä–∞ managed –ë–î Mysql –≤ Yandex Cloud —Å –æ–¥–Ω–∏–º –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏(2 –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) —Ö–æ—Å—Ç–∞–º–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π HA=true –∏–ª–∏ HA=false. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–µ—Å—É—Ä—Å yandex_mdb_mysql_cluster: –ø–µ—Ä–µ–¥–∞–π—Ç–µ –∏–º—è –∫–ª–∞—Å—Ç–µ—Ä–∞ –∏ id —Å–µ—Ç–∏.
2. –ù–∞–ø–∏—à–∏—Ç–µ –º–æ–¥—É–ª—å –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º –∫–ª–∞—Å—Ç–µ—Ä–µ managed –ë–î Mysql. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–µ—Å—É—Ä—Å—ã yandex_mdb_mysql_database –∏ yandex_mdb_mysql_user: –ø–µ—Ä–µ–¥–∞–π—Ç–µ –∏–º—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ id –∫–ª–∞—Å—Ç–µ—Ä–∞ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ –º–æ–¥—É–ª—è.
3. –ò—Å–ø–æ–ª—å–∑—É—è –æ–±–∞ –º–æ–¥—É–ª—è, —Å–æ–∑–¥–∞–π—Ç–µ –∫–ª–∞—Å—Ç–µ—Ä example –∏–∑ –æ–¥–Ω–æ–≥–æ —Ö–æ—Å—Ç–∞, –∞ –∑–∞—Ç–µ–º –¥–æ–±–∞–≤—å—Ç–µ –≤ –Ω–µ–≥–æ –ë–î test –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è app. –ó–∞—Ç–µ–º –∏–∑–º–µ–Ω–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –∏ –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç–µ —Å–∏–Ω–≥–ª —Ö–æ—Å—Ç –≤ –∫–ª–∞—Å—Ç–µ—Ä –∏–∑ 2-—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤.
4. –ü—Ä–µ–¥–æ—Å—Ç–∞–≤—å—Ç–µ –ø–ª–∞–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏ –ø–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç. –°—Ä–∞–∑—É –∂–µ —É–¥–∞–ª—è–π—Ç–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã, —Ç–∞–∫ –∫–∞–∫ –∫–ª–∞—Å—Ç–µ—Ä –º–æ–∂–µ—Ç —Å—Ç–æ–∏—Ç—å –æ—á–µ–Ω—å –¥–æ—Ä–æ–≥–æ. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é.

---------------------------------------------------------------------


#5.1–ù–∞–ø–∏—à–∏—Ç–µ –º–æ–¥—É–ª—å –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª–∞—Å—Ç–µ—Ä–∞ managed –ë–î Mysql –≤ Yandex Cloud —Å –æ–¥–Ω–∏–º –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏(2 –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) —Ö–æ—Å—Ç–∞–º–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π HA=true –∏–ª–∏ HA=false. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–µ—Å—É—Ä—Å yandex_mdb_mysql_cluster: –ø–µ—Ä–µ–¥–∞–π—Ç–µ –∏–º—è –∫–ª–∞—Å—Ç–µ—Ä–∞ –∏ id —Å–µ—Ç–∏.

----------------

pwd

# –°–¥–µ–ª–∞—Ç—å —Ñ–∞–π–ª –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º
chmod +x check_mysql_module.sh

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É
./check_mysql_module.sh

ls -la check_mysql_module.sh
-----------------------------


5.2 –ù–∞–ø–∏—à–∏—Ç–µ –º–æ–¥—É–ª—å –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º –∫–ª–∞—Å—Ç–µ—Ä–µ managed –ë–î Mysql. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–µ—Å—É—Ä—Å—ã yandex_mdb_mysql_database –∏ yandex_mdb_mysql_user: –ø–µ—Ä–µ–¥–∞–π—Ç–µ –∏–º—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ id –∫–ª–∞—Å—Ç–µ—Ä–∞ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ –º–æ–¥—É–ª—è.


--------------------------

1. –°–æ–∑–¥–∞–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –º–æ–¥—É–ª—è
mkdir -p modules/mysql-database


2.3. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ - —Å–º–æ—Ç—Ä–∏–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –º–æ–¥—É–ª—è
bash
echo "=== –î–ï–¢–ê–õ–¨–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê –°–û–î–ï–†–ñ–ò–ú–û–ì–û –ú–û–î–£–õ–Ø ==="
echo ""
echo "üìÅ modules/mysql-database/variables.tf:"
cat modules/mysql-database/variables.tf
echo ""
echo "üìÅ modules/mysql-database/main.tf:"
cat modules/mysql-database/main.tf
echo ""
echo "üìÅ modules/mysql-database/outputs.tf:"
cat modules/mysql-database/outputs.tf

chmod +x test_module_usage.tf
ls -la *.tf


3. –ó–∞–ø—É—Å—Ç–∏–º –ø—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –∑–∞–¥–∞–Ω–∏—è bash Copy Download ./check_mysql_database_assignment.sh

-------------------------


5.3 –ò—Å–ø–æ–ª—å–∑—É—è –æ–±–∞ –º–æ–¥—É–ª—è, —Å–æ–∑–¥–∞–π—Ç–µ –∫–ª–∞—Å—Ç–µ—Ä example –∏–∑ –æ–¥–Ω–æ–≥–æ —Ö–æ—Å—Ç–∞, –∞ –∑–∞—Ç–µ–º –¥–æ–±–∞–≤—å—Ç–µ –≤ –Ω–µ–≥–æ –ë–î test –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è app. –ó–∞—Ç–µ–º –∏–∑–º–µ–Ω–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –∏ –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç–µ —Å–∏–Ω–≥–ª —Ö–æ—Å—Ç –≤ –∫–ª–∞—Å—Ç–µ—Ä –∏–∑ 2-—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤.

-----------------
1. –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è single-host –∫–ª–∞—Å—Ç–µ—Ä–∞ —Å –ë–î –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º

2. –ü—Ä–∏–º–µ–Ω—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é single-host

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º 
terraform init -plugin-dir=/home/alexlinux/.terraform.d/plugins

# –°–º–æ—Ç—Ä–∏–º –ø–ª–∞–Ω
terraform plan


less MYSQL_ASSIGNMENT_COMPLETE.md


==================


5.4  –ü—Ä–µ–¥–æ—Å—Ç–∞–≤—å—Ç–µ –ø–ª–∞–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏ –ø–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç. –°—Ä–∞–∑—É –∂–µ —É–¥–∞–ª—è–π—Ç–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã, —Ç–∞–∫ –∫–∞–∫ –∫–ª–∞—Å—Ç–µ—Ä –º–æ–∂–µ—Ç —Å—Ç–æ–∏—Ç—å –æ—á–µ–Ω—å –¥–æ—Ä–æ–≥–æ. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é.

-------------
head -20 main.tf

1. –£–¥–∞–ª–∏–º –∏–ª–∏ –ø–µ—Ä–µ–∏–º–µ–Ω—É–µ–º –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏–µ –º–æ–¥—É–ª–∏
bash
# –ü–æ—Å–º–æ—Ç—Ä–∏–º —á—Ç–æ –≤ test_examples.tf
cat test_examples.tf

# –í–∞—Ä–∏–∞–Ω—Ç 1: –£–¥–∞–ª–∏–º test_examples.tf –µ—Å–ª–∏ –æ–Ω –¥—É–±–ª–∏—Ä—É–µ—Ç main.tf
rm test_examples.tf

# –ò–õ–ò –í–∞—Ä–∏–∞–Ω—Ç 2: –ü–µ—Ä–µ–∏–º–µ–Ω—É–µ–º –º–æ–¥—É–ª–∏ –≤ test_examples.tf –µ—Å–ª–∏ –æ–Ω–∏ –Ω—É–∂–Ω—ã
sed -i 's/module "vpc_prod"/module "vpc_prod_test"/g' test_examples.tf
sed -i 's/module "vpc_dev"/module "vpc_dev_test"/g' test_examples.tf


1. –ü—Ä–æ–≤–µ—Ä–∏–º –µ—Å—Ç—å –ª–∏ —Å–∫—Ä—ã—Ç—ã–µ —Ñ–∞–π–ª—ã —Å–æ—Å—Ç–æ—è–Ω–∏—è
bash
ls -la | grep -E "(\.terraform|terraform.tfstate)"


1. –í–µ—Ä–Ω–µ–º—Å—è –≤ –æ—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ–µ–∫—Ç –∏ –Ω–∞–π–¥–µ–º –í–°–ï —É–ø–æ–º–∏–Ω–∞–Ω–∏—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
bash
cd ~/terraform-project

# –ò—â–µ–º –í–°–ï —Ñ–∞–π–ª—ã —Å —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ–º hashicorp/yandex
find . -type f -exec grep -l "hashicorp/yandex" {} \; 2>/dev/null

# –ü—Ä–æ–≤–µ—Ä–∏–º —Ç–∞–∫–∂–µ –±–∏–Ω–∞—Ä–Ω—ã–µ —Ñ–∞–π–ª—ã –∏ —Å–∫—Ä—ã—Ç—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
find . -name ".terraform" -type d
2. –ü—Ä–æ–≤–µ—Ä–∏–º –µ—Å—Ç—å –ª–∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
bash
ls -la ~/.terraform.d/

# –ï—Å–ª–∏ –µ—Å—Ç—å –∫—ç—à, –æ—á–∏—Å—Ç–∏–º –µ–≥–æ
rm -rf ~/.terraform.d/plugins

1. –°–æ–∑–¥–∞–¥–∏–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø–ª–∞–≥–∏–Ω–æ–≤
bash
mkdir -p ~/.terraform.d/plugins
2. –í—ã–ø–æ–ª–Ω–∏–º –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
bash
terraform providers
3. –ü–æ—Å–º–æ—Ç—Ä–∏–º –∫–∞–∫–∏–µ –º–æ–¥—É–ª–∏ —Ç—Ä–µ–±—É—é—Ç –∫–∞–∫–∏–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã
bash
terraform providers schema -json | jq '.provider_schemas | keys'
4. –ü—Ä–æ–≤–µ—Ä–∏–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–æ–¥—É–ª–µ–π
bash
# –ü—Ä–æ–≤–µ—Ä–∏–º –µ—Å—Ç—å –ª–∏ –≤ –º–æ–¥—É–ª—è—Ö —Å–≤–æ–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã
find ./modules -name "*.tf" -exec grep -H "provider" {} \;




1. –ü—Ä–æ–≤–µ—Ä–∏–º –∏ –∏—Å–ø—Ä–∞–≤–∏–º –º–æ–¥—É–ª—å vpc
bash
# –ü–æ—Å–º–æ—Ç—Ä–∏–º —á—Ç–æ –≤ –º–æ–¥—É–ª–µ vpc
find ./modules/vpc -name "*.tf" -exec grep -H "provider" {} \;

# –ò—Å–ø—Ä–∞–≤–∏–º –ø—Ä–æ–≤–∞–π–¥–µ—Ä –≤ –º–æ–¥—É–ª–µ vpc
find ./modules/vpc -name "*.tf" -exec sed -i 's|hashicorp/yandex|yandex-cloud/yandex|g' {} \;
2. –ü—Ä–æ–≤–µ—Ä–∏–º –≤—Å–µ –º–æ–¥—É–ª–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
bash
# –ü—Ä–æ–≤–µ—Ä–∏–º –≤—Å–µ –º–æ–¥—É–ª–∏
find ./modules -name "*.tf" -exec grep -H "hashicorp/yandex" {} \;

# –ò—Å–ø—Ä–∞–≤–∏–º –≤–æ –≤—Å–µ—Ö –º–æ–¥—É–ª—è—Ö
find ./modules -name "*.tf" -exec sed -i 's|hashicorp/yandex|yandex-cloud/yandex|g' {} \;
3. –ü–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—Å—Ç–∏–º –∏ –ø–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º
bash
rm -rf .terraform .terraform.lock.hcl
terraform init
4. –ü—Ä–æ–≤–µ—Ä–∏–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
bash
terraform providers
5. –ï—Å–ª–∏ –≤—Å–µ –æ–∫, –ø—Ä–æ–≤–µ—Ä–∏–º –≤–∞–ª–∏–¥–∞—Ü–∏—é
bash
terraform validate


–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –≤—Ä—É—á–Ω—É—é
1. –°–∫–∞—á–∞–µ–º –ø—Ä–æ–≤–∞–π–¥–µ—Ä –≤—Ä—É—á–Ω—É—é
bash
# –°–æ–∑–¥–∞–¥–∏–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
mkdir -p ~/.terraform.d/plugins/registry.terraform.io/yandex-cloud/yandex/0.171.0/linux_amd64

# –°–∫–∞—á–∞–µ–º –ø—Ä–æ–≤–∞–π–¥–µ—Ä (–∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä—è–º—É—é —Å—Å—ã–ª–∫—É –∏–ª–∏ –∏–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞)
cd ~/.terraform.d/plugins/registry.terraform.io/yandex-cloud/yandex/0.171.0/linux_amd64
wget https://releases.hashicorp.com/terraform-provider-yandex/0.171.0/terraform-provider-yandex_0.171.0_linux_amd64.zip
unzip terraform-provider-yandex_0.171.0_linux_amd64.zip
rm terraform-provider-yandex_0.171.0_linux_amd64.zip
2. –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ: –∏—Å–ø–æ–ª—å–∑—É–µ–º mirror –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏
bash
cd ~/terraform-project

# –°–æ–∑–¥–∞–¥–∏–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —Å mirror
cat > .terraformrc << 'EOF'
provider_installation {
  filesystem_mirror {
    path    = "/home/alexlinux/.terraform.d/plugins"
    include = ["yandex-cloud/yandex"]
  }
  direct {
    exclude = ["yandex-cloud/yandex"]
  }
}
EOF
3. –ò–ª–∏ –ø–æ–ø—Ä–æ–±—É–µ–º —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —á–µ—Ä–µ–∑ terraform
bash
# –£–¥–∞–ª–∏–º —Å—Ç–∞—Ä—ã–µ –∫–æ–Ω—Ñ–∏–≥–∏ –∏ –ø–æ–ø—Ä–æ–±—É–µ–º —Å–Ω–æ–≤–∞
rm -rf .terraform .terraform.lock.hcl

# –ü–æ–ø—Ä–æ–±—É–µ–º —Å –æ–ø—Ü–∏–µ–π -plugin-dir
terraform init -plugin-dir=/home/alexlinux/.terraform.d/plugins


1. –ü—Ä–æ–≤–µ—Ä–∏–º –Ω–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–∞ —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏
bash
cat terraform.tfvars




























### –ó–∞–¥–∞–Ω–∏–µ 6*
1. –ò—Å–ø–æ–ª—å–∑—É—è –≥–æ—Ç–æ–≤—ã–π yandex cloud terraform module –∏ –ø—Ä–∏–º–µ—Ä –µ–≥–æ –≤—ã–∑–æ–≤–∞(examples/simple-bucket): https://github.com/terraform-yc-modules/terraform-yc-s3 .
–°–æ–∑–¥–∞–π—Ç–µ –∏ –Ω–µ —É–¥–∞–ª—è–π—Ç–µ –¥–ª—è —Å–µ–±—è s3 –±–∞–∫–µ—Ç —Ä–∞–∑–º–µ—Ä–æ–º 1 –ì–ë(—ç—Ç–æ –±–µ—Å–ø–ª–∞—Ç–Ω–æ), –æ–Ω –ø—Ä–∏–≥–æ–¥–∏—Ç—Å—è –≤–∞–º –≤ –î–ó –∫ 5 –ª–µ–∫—Ü–∏–∏.

---------------------------------------------
cd ~/ter-homeworks-new/06-s3-bucket

# –°–æ–∑–¥–∞–¥–∏–º —Ñ–∏–Ω–∞–ª—å–Ω—É—é –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
cat > main.tf << 'EOF'
terraform {
  required_version = ">= 1.0"
  required_providers {
    yandex = {
      source  = "yandex-cloud/yandex"
      version = ">= 0.92.0"
    }
  }
}

provider "yandex" {
  folder_id = "b1gokds3ue11292eobjh"
}

# –°–æ–∑–¥–∞–µ–º —Å–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç –¥–ª—è –±–∞–∫–µ—Ç–∞
resource "yandex_iam_service_account" "s3_sa" {
  name        = "s3-bucket-sa"
  description = "Service account for S3 bucket management"
}

# –î–∞–µ–º –ø—Ä–∞–≤–∞ –Ω–∞ storage.editor
resource "yandex_resourcemanager_folder_iam_member" "s3_editor" {
  folder_id = "b1gokds3ue11292eobjh"
  role      = "storage.editor"
  member    = "serviceAccount:${yandex_iam_service_account.s3_sa.id}"
}

# –°–æ–∑–¥–∞–µ–º —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –∫–ª—é—á–∏ –¥–æ—Å—Ç—É–ø–∞
resource "yandex_iam_service_account_static_access_key" "s3_sa_keys" {
  service_account_id = yandex_iam_service_account.s3_sa.id
  description        = "Static access keys for S3 bucket"
}

# –°–æ–∑–¥–∞–µ–º S3 –±–∞–∫–µ—Ç —Å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–º –∏–º–µ–Ω–µ–º
resource "yandex_storage_bucket" "homework_bucket" {
  # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏–º—è –Ω–∞ –æ—Å–Ω–æ–≤–µ folder_id –±–µ–∑ –¥–µ—Ñ–∏—Å–æ–≤ + —Å—É—Ñ—Ñ–∏–∫—Å
  bucket     = "tf-homework-${replace("b1gokds3ue11292eobjh", "-", "")}-001"
  access_key = yandex_iam_service_account_static_access_key.s3_sa_keys.access_key
  secret_key = yandex_iam_service_account_static_access_key.s3_sa_keys.secret_key

  max_size = 1073741824 # 1 GB in bytes

  anonymous_access_flags {
    read = false
    list = false
  }

  # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º versioning —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –æ—à–∏–±–æ–∫ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
  # –ë–∞–∫–µ—Ç –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ –±–µ–∑ versioning
}
EOF
–¢–µ–ø–µ—Ä—å –ø—Ä–∏–º–µ–Ω–∏–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:

bash
# –£–Ω–∏—á—Ç–æ–∂–∏–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –Ω–µ—É–¥–∞—á–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏
terraform destroy -auto-approve

# –ü—Ä–∏–º–µ–Ω–∏–º –Ω–æ–≤—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
terraform apply -auto-approve


1. –ü—Ä–æ–≤–µ—Ä–∏–º —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
bash
cd ~/ter-homeworks-new

# –ü—Ä–æ–≤–µ—Ä–∏–º —Å—Ç–∞—Ç—É—Å git
git status

# –ü—Ä–æ–≤–µ—Ä–∏–º –∏—Å—Ç–æ—Ä–∏—é –∫–æ–º–º–∏—Ç–æ–≤
git log --oneline -5

# –ü—Ä–æ–≤–µ—Ä–∏–º remote
git remote -v
2. –ü—Ä–æ–≤–µ—Ä–∏–º –¥–æ—Å—Ç—É–ø –∫ GitHub
bash
# –ü—Ä–æ–≤–µ—Ä–∏–º, –º–æ–∂–µ–º –ª–∏ –º—ã –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—é
curl -I https://github.com/sapr797/ter-homeworks

# –ò–ª–∏ –ø–æ–ø—Ä–æ–±—É–µ–º –∫–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å (—Ç–æ–ª—å–∫–æ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–∞)
git ls-remote https://github.com/sapr797/ter-homeworks.git
3. –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–ø—É—à–µ–Ω—ã
bash
# –ü—Ä–æ–≤–µ—Ä–∏–º —Ä–∞–∑–Ω–∏—Ü—É –º–µ–∂–¥—É –ª–æ–∫–∞–ª—å–Ω–æ–π –∏ —É–¥–∞–ª–µ–Ω–Ω–æ–π –≤–µ—Ç–∫–æ–π
git log --oneline HEAD..origin/terraform-hotfix-final

# –ï—Å–ª–∏ –µ—Å—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–µ –∫–æ–º–º–∏—Ç—ã, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –≤ remote, –∑–∞–ø—É—à–∏–º –∏—Ö
git push origin terraform-hotfix-final

5. –ü—Ä–æ–≤–µ—Ä–∏–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –≤ –±—Ä–∞—É–∑–µ—Ä–µ

https://github.com/sapr797/ter-homeworks


–í–µ—Ç–∫–∞ terraform-hotfix-final:

https://github.com/sapr797/ter-homeworks/tree/terraform-hotfix-final

# –ü—Ä–æ–≤–µ—Ä–∏–º –≤—Å–µ –≤–µ—Ç–∫–∏

alexlinux@compute-vm-2-2-10-hdd-1763671349887:~/ter-homeworks-new$ git branch -a
  main
* terraform-hotfix-final
  remotes/origin/HEAD -> origin/main
  remotes/origin/main
  remotes/origin/patch-1
  remotes/origin/patch-2
  remotes/origin/patch-3
  remotes/origin/patch-4
  remotes/origin/remote_state
  remotes/origin/terraform-03
  remotes/origin/terraform-05
  remotes/origin/terraform-hotfix-final
  remotes/origin/test-01


# –°–æ–∑–¥–∞–¥–∏–º Personal Access Token –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
echo "–ï—Å–ª–∏ push –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, —Å–æ–∑–¥–∞–π—Ç–µ Personal Access Token:"
echo "1. –ó–∞–π–¥–∏—Ç–µ –≤ GitHub Settings -> Developer settings -> Personal access tokens -> Tokens (classic)"
echo "2. –°–æ–∑–¥–∞–π—Ç–µ —Ç–æ–∫–µ–Ω —Å –ø—Ä–∞–≤–∞–º–∏ 'repo'"
echo "3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –µ–≥–æ –∫–∞–∫ –ø–∞—Ä–æ–ª—å –ø—Ä–∏ push"

9. –°–æ–∑–¥–∞–¥–∏–º Pull Request (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–∑ terraform-hotfix-final –≤ main:

# –°–æ–∑–¥–∞–¥–∏–º PR —á–µ—Ä–µ–∑ GitHub CLI
gh pr create --base main --head terraform-hotfix-final --title "Add S3 bucket for homework" --body "Complete task 6*: Create 1GB S3 bucket for future homeworks"
10. –ü—Ä–æ–≤–µ—Ä–∏–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
–£–±–µ–¥–∏–º—Å—è, —á—Ç–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ–∂–∏–¥–∞–Ω–∏—è–º:

# –õ–æ–∫–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
find . -name "*.tf" -type f | head -20

# –ü—Ä–æ–≤–µ—Ä–∏–º –Ω–∞–ª–∏—á–∏–µ –ø–∞–ø–∫–∏ 06-s3-bucket
ls -la | grep 06-s3-bucket
–ï—Å–ª–∏ –≤—Å–µ –µ—â–µ –µ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã
–ï—Å–ª–∏ –ø–æ—Å–ª–µ –≤—Å–µ—Ö —à–∞–≥–æ–≤ –≤—ã –Ω–µ –≤–∏–¥–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞ GitHub:

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ URL remote:

git remote -v
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –ø—É—à–∏—Ç–µ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:

git push origin terraform-hotfix-final


# –î–æ–±–∞–≤–∏–º –ø—Ä–∞–≤–∏–ª–æ –≤ .gitignore
echo "06-s3-bucket/*_secret_key.txt" >> .gitignore
echo "06-s3-bucket/*.token" >> .gitignore
echo "06-s3-bucket/terraform.tfvars" >> .gitignore


–°–æ–∑–¥–∞–¥–∏–º –∫–æ–º–º–∏—Ç 

# –î–æ–±–∞–≤–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ staging
git add .gitignore

# –°–æ–∑–¥–∞–¥–∏–º  –∫–æ–º–º–∏—Ç 
git commit --amend -m "Complete task 6*: Successfully create S3 bucket with 1GB storage

- Create S3 bucket: tf-homework-b1gokds3ue11292eobjh-001
- Create service account with storage.editor permissions
- Generate static access keys for authentication
- Configure 1GB max size (free tier)
- Set up private access policies
- Ready for use in lecture 5 and future assignments
- Remove secret key file from repository for security"

–ü–æ–ø—Ä–æ–±—É–µ–º push
 git push origin terraform-hotfix-final


–ë–µ–∑–æ–ø–∞—Å–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å —Å–µ–∫—Ä–µ—Ç—ã  –≤ Terraform –ø—Ä–æ–µ–∫—Ç–∞—Ö:

1.–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
export AWS_ACCESS_KEY_ID="your_access_key"
export AWS_SECRET_ACCESS_KEY="your_secret_key"
–í–∞—Ä–∏–∞–Ω—Ç B: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å terraform.tfvars (–≤ .gitignore)

2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å terraform.tfvars 
# terraform.tfvars (–¥–æ–±–∞–≤–ª–µ–Ω –≤ .gitignore)
access_key = "your_access_key"
secret_key = "your_secret_key"

–ü—Ä–æ–≤–µ—Ä–∏–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

# –ü—Ä–æ–≤–µ—Ä–∏–º —Å—Ç–∞—Ç—É—Å
git status

# –ü—Ä–æ–≤–µ—Ä–∏–º –∏—Å—Ç–æ—Ä–∏—é –∫–æ–º–º–∏—Ç–æ–≤
git log --oneline -3

# –ü—Ä–æ–≤–µ—Ä–∏–º, —á—Ç–æ —Å–µ–∫—Ä–µ—Ç–Ω—ã–π —Ñ–∞–π–ª —É–¥–∞–ª–µ–Ω –∏–∑ –∏–Ω–¥–µ–∫—Å–∞
git ls-files | grep secret

1. –ü—Ä–æ–≤–µ—Ä–∏–º —Ç–µ–∫—É—â–∏–µ remote

git remote -v

2. –ù–∞—Å—Ç—Ä–æ–∏–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ remote

# –ü–µ—Ä–µ–∏–º–µ–Ω—É–µ–º —Ç–µ–∫—É—â–∏–π origin –≤ upstream (–µ—Å–ª–∏ –æ–Ω —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ netology-code)
git remote rename origin upstream

# –î–æ–±–∞–≤–∏–º –≤–∞—à —Ñ–æ—Ä–∫ –∫–∞–∫ origin
git remote add origin git@github.com:sapr797/ter-homeworks.git

# –ü—Ä–æ–≤–µ—Ä–∏–º
git remote -v


3. –û–±–Ω–æ–≤–∏–º –≤–µ—Ç–∫—É main –∏–∑ –≤–∞—à–µ–≥–æ —Ñ–æ—Ä–∫–∞

# –ü–µ—Ä–µ–∫–ª—é—á–∏–º—Å—è –Ω–∞ main
git checkout main

# –£—Å—Ç–∞–Ω–æ–≤–∏–º tracking –Ω–∞ –≤–∞—à —Ñ–æ—Ä–∫
git branch --set-upstream-to=origin/main

# –û–±–Ω–æ–≤–∏–º –∏–∑ –≤–∞—à–µ–≥–æ —Ñ–æ—Ä–∫–∞
git pull origin main


4. –°–æ–∑–¥–∞–¥–∏–º –Ω–æ–≤—É—é –≤–µ—Ç–∫—É –¥–ª—è PR –≤ –≤–∞—à–µ–º —Ñ–æ—Ä–∫–µ

# –°–æ–∑–¥–∞–¥–∏–º –Ω–æ–≤—É—é –≤–µ—Ç–∫—É
git checkout -b pr-for-task6

# –í–Ω–µ—Å–µ–º –Ω–µ–±–æ–ª—å—à–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ (–¥–æ–±–∞–≤–∏–º README)
echo "# Task 6* - S3 Bucket Configuration" > 04/src/06-s3-bucket/README.md
echo "This module creates a 1GB S3 bucket for homework assignments." >> 04/src/06-s3-bucket/README.md

# –î–æ–±–∞–≤–∏–º –∏ –∑–∞–∫–æ–º–º–∏—Ç–∏–º
git add 04/src/06-s3-bucket/README.md
git commit -m "Add README for task 6* S3 bucket module"

# –ó–∞–ø—É—à–∏–º –≤ –í–ê–® —Ñ–æ—Ä–∫
git push origin pr-for-task6


5. –°–æ–∑–¥–∞–¥–∏–º PR –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
–¢–µ–ø–µ—Ä—å —Å–æ–∑–¥–∞–¥–∏–º PR –≤–µ:

–°–ø–æ—Å–æ–± A: –ß–µ—Ä–µ–∑ –ø—Ä—è–º—É—é —Å—Å—ã–ª–∫—É
–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:

https://github.com/sapr797/ter-homeworks/compare/main...pr-for-task6?expand=1
–°–ø–æ—Å–æ–± B: –ß–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
–û—Ç–∫—Ä–æ–π—Ç–µ: https://github.com/sapr797/ter-homeworks

–ù–∞–∂–º–∏—Ç–µ "Pull requests" ‚Üí "New pull request"

–í—ã–±–µ—Ä–∏—Ç–µ:

base repository: sapr797/ter-homeworks
base: main
compare: pr-for-task6

6. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ PR –¥–ª—è –≤–∞—à–µ–≥–æ —Ñ–æ—Ä–∫–∞
Title: "Task 6*: Add S3 bucket configuration"

Description:

## Task 6* Completion
Add S3 bucket module to 04/src/06-s3-bucket/

### Changes:
- Terraform configuration for 1GB S3 bucket
- Service account with storage.editor role
- Static access keys for authentication
- README documentation

### Purpose:
- Complete task 6* requirements
- Provide cloud storage for future homeworks
7. –°–º–µ—Ä–∂–∏—Ç–µ PR –≤ –≤–∞—à–µ–º —Ñ–æ—Ä–∫–µ
–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è PR:

–ù–∞–∂–º–∏—Ç–µ "Merge pull request"

–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –º–µ—Ä–∂

–£–¥–∞–ª–∏—Ç–µ –≤–µ—Ç–∫—É pr-for-task6

8. –ü—Ä–æ–≤–µ—Ä–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
–ü–æ—Å–ª–µ –º–µ—Ä–∂–∞ –ø—Ä–æ–≤–µ—Ä–∏–º:

https://github.com/sapr797/ter-homeworks/tree/main/04/src/06-s3-bucket
–¢–µ–ø–µ—Ä—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ñ–∞–π–ª README.md –≤–º–µ—Å—Ç–µ —Å –æ—Å—Ç–∞–ª—å–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏.

9. –ù–∞—Å—Ç—Ä–æ–∏–º git 

# –£—Å—Ç–∞–Ω–æ–≤–∏–º origin –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è push
git config push.default current

# –£—Å—Ç–∞–Ω–æ–≤–∏–º –≤ —Ñ–æ—Ä–∫ –∫–∞–∫ default remote
git config remote.pushdefault origin

# –ü—Ä–æ–≤–µ—Ä–∏–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
git config --list | grep remote
10. –î–ª—è –±—É–¥—É—â–∏—Ö –∑–∞–¥–∞–Ω–∏–π
–¢–µ–ø–µ—Ä—å –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤—ã—Ö –≤–µ—Ç–æ–∫:

# –°–æ–∑–¥–∞–µ–º –≤–µ—Ç–∫—É
git checkout -b new-feature

# –î–µ–ª–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è...
git add .
git commit -m "My changes"

# –ü—É—à–∏–º –≤ –í–ê–® —Ñ–æ—Ä–∫
git push origin new-feature

# –°–æ–∑–¥–∞–µ–º PR –≤ –í–ê–®–ï–ú —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
# https://github.com/sapr797/ter-homeworks/compare/main...new-feature


https://github.com/netology-code/ter-homeworks/pull/37
https://github.com/netology-code/ter-homeworks/pull/39

https://github.com/sapr797/ter-homeworks/pull/3
https://github.com/sapr797/ter-homeworks/tree/main/04/src/06-s3-bucket





























### –ó–∞–¥–∞–Ω–∏–µ 7*

1. –†–∞–∑–≤–µ—Ä–Ω–∏—Ç–µ —É —Å–µ–±—è –ª–æ–∫–∞–ª—å–Ω–æ vault, –∏—Å–ø–æ–ª—å–∑—É—è docker-compose.yml –≤ –ø—Ä–æ–µ–∫—Ç–µ.
2. –î–ª—è –≤—Ö–æ–¥–∞ –≤ web-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ terraform –≤ vault –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–∫–µ–Ω "education".
3. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π —Å–µ–∫—Ä–µ—Ç –ø–æ –ø—É—Ç–∏ http://127.0.0.1:8200/ui/vault/secrets/secret/create
Path: example  
secret data key: test 
secret data value: congrats!  
4. –°—á–∏—Ç–∞–π—Ç–µ —ç—Ç–æ—Ç —Å–µ–∫—Ä–µ—Ç —Å –ø–æ–º–æ—â—å—é terraform –∏ –≤—ã–≤–µ–¥–∏—Ç–µ –µ–≥–æ –≤ output –ø–æ –ø—Ä–∏–º–µ—Ä—É:
```
provider "vault" {
 address = "http://<IP_ADDRESS>:<PORT_NUMBER>"
 skip_tls_verify = true
 token = "education"
}
data "vault_generic_secret" "vault_example"{
 path = "secret/example"
}

output "vault_example" {
 value = "${nonsensitive(data.vault_generic_secret.vault_example.data)}"
} 

–ú–æ–∂–Ω–æ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –Ω–µ –∫ —Å–ª–æ–≤–∞—Ä—é, –∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –∫–ª—é—á—É:
terraform console: >nonsensitive(data.vault_generic_secret.vault_example.data.<–∏–º—è –∫–ª—é—á–∞ –≤ —Å–µ–∫—Ä–µ—Ç–µ>)
```
5. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏ –∑–∞–ø–∏—Å–∞—Ç—å –Ω–æ–≤—ã–π —Å–µ–∫—Ä–µ—Ç –≤ vault —Å –ø–æ–º–æ—â—å—é terraform. 

--------------------------------





1. –°–æ–∑–¥–∞–¥–∏–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –∑–∞–¥–∞–Ω–∏—è 7*

cd ~/ter-homeworks-new
mkdir -p 07-vault
cd 07-vault
2. –°–æ–∑–¥–∞–¥–∏–º docker-compose.yml –¥–ª—è –∑–∞–ø—É—Å–∫–∞ Vault

cat > docker-compose.yml << 'EOF'
version: '3.7'

services:
  vault:
    image: vault:1.13.3
    container_name: vault
    ports:
      - "8200:8200"
    environment:
      - VAULT_DEV_ROOT_TOKEN_ID=education
      - VAULT_DEV_LISTEN_ADDRESS=0.0.0.0:8200
    cap_add:
      - IPC_LOCK
    volumes:
      - ./vault_data:/vault/data
    restart: unless-stopped

  # –î–æ–±–∞–≤–∏–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å Terraform –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
  terraform:
    image: hashicorp/terraform:1.5
    container_name: terraform-vault
    volumes:
      - .:/workspace
    working_dir: /workspace
    depends_on:
      - vault
    stdin_open: true
    tty: true
    command: ["sleep", "infinity"]
EOF

3. –ó–∞–ø—É—Å—Ç–∏–º Vault

# –°–æ–∑–¥–∞–¥–∏–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –¥–∞–Ω–Ω—ã—Ö Vault
mkdir -p vault_data

# –ó–∞–ø—É—Å—Ç–∏–º —Å–µ—Ä–≤–∏—Å—ã

sudo apt update
sudo apt install docker-compose
docker --version
sudo docker-compose up -d

# –ü—Ä–æ–≤–µ—Ä–∏–º, —á—Ç–æ Vault –∑–∞–ø—É—Å—Ç–∏–ª—Å—è
docker-compose ps

# –ü—Ä–æ–≤–µ—Ä–∏–º —Å—Ç–∞—Ç—É—Å Vault
docker-compose exec vault vault status

 –î–æ–±–∞–≤–∏–º —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –≥—Ä—É–ø–ø—É docker
sudo usermod -aG docker $USER

# –ü—Ä–∏–º–µ–Ω–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≥—Ä—É–ø–ø—ã (–±–µ–∑ –ø–µ—Ä–µ–ª–æ–≥–∏–Ω–∞)
newgrp docker

# –ü—Ä–æ–≤–µ—Ä–∏–º, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ –≥—Ä—É–ø–ø–µ docker
groups

# –ü—Ä–æ–≤–µ—Ä–∏–º –¥–æ—Å—Ç—É–ø –∫ Docker
docker ps

4. –°–æ–∑–¥–∞–¥–∏–º —Å–µ–∫—Ä–µ—Ç —á–µ—Ä–µ–∑ CLI

# –°–æ–∑–¥–∞–¥–∏–º —Å–µ–∫—Ä–µ—Ç —á–µ—Ä–µ–∑ CLI
docker exec vault vault login education
docker exec vault vault kv put secret/example test=congrats!

# –ü—Ä–æ–≤–µ—Ä–∏–º —Å–µ–∫—Ä–µ—Ç
docker exec vault vault kv get secret/example

# –í–æ–π–¥–µ–º –≤ Vault
docker-compose exec vault vault login education

# –°–æ–∑–¥–∞–¥–∏–º —Å–µ–∫—Ä–µ—Ç
docker-compose exec vault vault kv put secret/example test=congrats!
6. –°–æ–∑–¥–∞–¥–∏–º Terraform –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è —á—Ç–µ–Ω–∏—è —Å–µ–∫—Ä–µ—Ç–∞

cat > main.tf << 'EOF'
terraform {
  required_version = ">= 1.5"

  required_providers {
    vault = {
      source  = "hashicorp/vault"
      version = "3.18.0"
    }
  }
}

provider "vault" {
  address         = "http://localhost:8200"
  skip_tls_verify = true
  token           = "education"
}

# –ß—Ç–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Å–µ–∫—Ä–µ—Ç–∞
data "vault_generic_secret" "vault_example" {
  path = "secret/example"
}

output "vault_example" {
  value = nonsensitive(data.vault_generic_secret.vault_example.data)
}

output "vault_example_test_key" {
  value = nonsensitive(data.vault_generic_secret.vault_example.data["test"])
}

# –ó–∞–ø–∏—Å—å –Ω–æ–≤–æ–≥–æ —Å–µ–∫—Ä–µ—Ç–∞ –≤ Vault
resource "vault_generic_secret" "terraform_secret" {
  path = "secret/terraform-generated"

  data_json = jsonencode({
    username = "terraform-user"
    password = "super-secret-password-123"
    message  = "This secret was created by Terraform!"
  })
}

output "terraform_created_secret" {
  value     = nonsensitive(vault_generic_secret.terraform_secret.data)
  sensitive = false
}

output "secret_creation_message" {
  value = "New secret created at path: ${vault_generic_secret.terraform_secret.path}"
}
EOF

–í—ã–ø–æ–ª–Ω–∏–º Terraform

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Terraform
terraform init

# –ü—Ä–æ–≤–µ—Ä–∏–º –ø–ª–∞–Ω
terraform plan

# –ü—Ä–∏–º–µ–Ω–∏–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
terraform apply -auto-approve

7. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∏ –∑–∞–ø—É—Å—Ç–∏–º Terraform

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Terraform –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
docker-compose exec terraform terraform init

# –ü—Ä–æ–≤–µ—Ä–∏–º –ø–ª–∞–Ω
docker-compose exec terraform terraform plan

8. –ü—Ä–æ–≤–µ—Ä–∏–º —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Å–µ–∫—Ä–µ—Ç—ã
# –ü—Ä–æ–≤–µ—Ä–∏–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Å–µ–∫—Ä–µ—Ç
docker exec vault vault kv get secret/example

# –ü—Ä–æ–≤–µ—Ä–∏–º —Å–µ–∫—Ä–µ—Ç, —Å–æ–∑–¥–∞–Ω–Ω—ã–π Terraform
docker exec vault vault kv get secret/terraform-generated

# –ü—Ä–æ–≤–µ—Ä–∏–º —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Å–µ–∫—Ä–µ—Ç–æ–≤
docker exec vault vault kv list secret/


9. –°–æ–∑–¥–∞–¥–∏–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è –∑–∞–¥–∞–Ω–∏—è

# –°–æ–∑–¥–∞–¥–∏–º README —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏ –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞
cat > README_DOCKER.md << 'EOF'
# Task 7* - HashiCorp Vault with Direct Docker

This approach uses direct Docker commands instead of Docker Compose due to permission issues.

## Setup

1. Start Vault server:
   
   docker run -d \
     --name vault \
     -p 8200:8200 \
     -e VAULT_DEV_ROOT_TOKEN_ID=education \
     -e VAULT_DEV_LISTEN_ADDRESS=0.0.0.0:8200 \
     --cap-add=IPC_LOCK \
     vault:1.13.3
Create initial secret:

docker exec vault vault login education
docker exec vault vault kv put secret/example test=congrats!
Run Terraform:

terraform init
terraform apply
Access
Vault UI: http://localhost:8200

Token: education

Cleanup

docker stop vault
docker rm vault
EOF



# –ü—Ä–∏–º–µ–Ω–∏–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
docker-compose exec terraform terraform apply -auto-approve
8. –°–æ–∑–¥–∞–¥–∏–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è –∑–∞–ø–∏—Å–∏ –Ω–æ–≤–æ–≥–æ —Å–µ–∫—Ä–µ—Ç–∞
–¢–µ–ø–µ—Ä—å –¥–æ–±–∞–≤–∏–º —Ä–µ—Å—É—Ä—Å –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ —Å–µ–∫—Ä–µ—Ç–∞ —á–µ—Ä–µ–∑ Terraform:


cat >> main.tf << 'EOF'

# –ó–∞–ø–∏—Å—å –Ω–æ–≤–æ–≥–æ —Å–µ–∫—Ä–µ—Ç–∞ –≤ Vault
resource "vault_generic_secret" "terraform_secret" {
  path = "secret/terraform-generated"

  data_json = jsonencode({
    username = "terraform-user"
    password = "super-secret-password-123"
    message  = "This secret was created by Terraform!"
  })
}

output "terraform_created_secret" {
  value     = nonsensitive(vault_generic_secret.terraform_secret.data)
  sensitive = false
}

output "secret_creation_message" {
  value = "New secret created at path: ${vault_generic_secret.terraform_secret.path}"
}
EOF

9. –ü—Ä–∏–º–µ–Ω–∏–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

# –ü—Ä–∏–º–µ–Ω–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
docker-compose exec terraform terraform apply -auto-approve
10. –ü—Ä–æ–≤–µ—Ä–∏–º —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Å–µ–∫—Ä–µ—Ç—ã —á–µ—Ä–µ–∑ CLI

# –ü—Ä–æ–≤–µ—Ä–∏–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Å–µ–∫—Ä–µ—Ç
docker-compose exec vault vault kv get secret/example

# –ü—Ä–æ–≤–µ—Ä–∏–º —Å–µ–∫—Ä–µ—Ç, —Å–æ–∑–¥–∞–Ω–Ω—ã–π Terraform
docker-compose exec vault vault kv get secret/terraform-generated
11. –°–æ–∑–¥–∞–¥–∏–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è –ø–æ–ª–Ω–æ—Ç—ã –∑–∞–¥–∞–Ω–∏—è

# –°–æ–∑–¥–∞–¥–∏–º outputs.tf –¥–ª—è –ª—É—á—à–µ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
cat > outputs.tf << 'EOF'
output "vault_address" {
  description = "Vault server address"
  value       = "http://127.0.0.1:8200"
}

output "vault_token" {
  description = "Vault authentication token"
  value       = "education"
  sensitive   = true
}

output "all_outputs" {
  description = "Summary of all Vault operations"
  value       = <<EOT
Vault Task 7* Completed Successfully!

Operations performed:
1. Vault server running at: http://127.0.0.1:8200
2. Read existing secret from path: secret/example
3. Created new secret at path: secret/terraform-generated
4. All secrets are accessible with token: education

To access Vault UI:
- URL: http://127.0.0.1:8200/ui
- Token: education

To view secrets via CLI:
docker-compose exec vault vault kv get secret/example
docker-compose exec vault vault kv get secret/terraform-generated
EOT
}
EOF

# –°–æ–∑–¥–∞–µ–º README —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏
cat > README.md << 'EOF'
# Task 7* - HashiCorp Vault with Terraform

This task demonstrates integration between Terraform and HashiCorp Vault.

## Prerequisites
- Docker and Docker Compose
- Terraform

## Setup

1. Start Vault server:
 
   docker-compose up -d
Initialize and apply Terraform configuration:

docker-compose exec terraform terraform init
docker-compose exec terraform terraform apply
Vault Access
Web UI: http://127.0.0.1:8200/ui

Token: education

CLI Access: docker-compose exec vault vault <command>

Secrets Management
Reading Secrets
Terraform reads existing secrets from Vault using vault_generic_secret data source.

cd ~/ter-homeworks-new/07-vault


# –°–Ω–∞—á–∞–ª–∞ –æ—Å—Ç–∞–Ω–æ–≤–∏–º –∏ —É–¥–∞–ª–∏–º —Å—Ç–∞—Ä—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, –µ—Å–ª–∏ –æ–Ω —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
docker stop vault 2>/dev/null || true
docker rm vault 2>/dev/null || true


# –°–æ–∑–¥–∞–¥–∏–º —Å–µ—Ç—å Docker 
docker network create vault-network

# –ó–∞–ø—É—Å—Ç–∏–º Vault –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
ddocker run -d \
  --name vault \
  --network vault-network \
  -p 8200:8200 \
  -e VAULT_DEV_ROOT_TOKEN_ID=education \
  -e VAULT_DEV_LISTEN_ADDRESS=0.0.0.0:8200 \
  -e VAULT_DEV_KV_V1=1 \
  --cap-add=IPC_LOCK \
  vault:1.13.3

# –ü—Ä–æ–≤–µ—Ä–∏–º, —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—Å—Ç–∏–ª—Å—è
docker ps -a| grep vault

# –ü–æ–¥–æ–∂–¥–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é Vault
sleep 5

# –ù–∞—Å—Ç—Ä–æ–∏–º Vault CLI
export VAULT_ADDR='http://127.0.0.1:8200'

# –í–æ–π–¥–µ–º –≤ Vault –∏ —Å–æ–∑–¥–∞–¥–∏–º —Å–µ–∫—Ä–µ—Ç
docker exec -e VAULT_ADDR='http://127.0.0.1:8200' vault vault login education
docker exec -e VAULT_ADDR='http://127.0.0.1:8200' vault vault kv put secret/example test=congrats!

# –ü—Ä–æ–≤–µ—Ä–∏–º —Å–µ–∫—Ä–µ—Ç
docker exec -e VAULT_ADDR='http://127.0.0.1:8200' vault vault kv get secret/example

–¢–µ–ø–µ—Ä—å –≤—ã–ø–æ–ª–Ω–∏–º Terraform:

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∏ –ø—Ä–∏–º–µ–Ω–∏–º Terraform
terraform init
terraform apply -auto-approve


Writing Secrets
Terraform creates new secrets using vault_generic_secret resource.

Verification
Check created secrets:

# Via CLI
docker-compose exec vault vault kv list secret/
docker-compose exec vault vault kv get secret/example
docker-compose exec vault vault kv get secret/terraform-generated

# Via Terraform outputs
docker-compose exec terraform terraform output
Cleanup
Stop and remove containers:

docker-compose down
EOF

–°–æ–∑–¥–∞–µ–º —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏
cat > setup-vault.sh << 'EOF'
#!/bin/bash
echo "Setting up Vault for Task 7*"

Check if Vault container is already running
if docker ps | grep -q vault; then
echo "Vault container is already running"
else
echo "Starting Vault container..."
docker run -d
--name vault
-p 8200:8200
-e VAULT_DEV_ROOT_TOKEN_ID=education
-e VAULT_DEV_LISTEN_ADDRESS=0.0.0.0:8200
--cap-add=IPC_LOCK
vault:1.13.3
sleep 5
fi

Initialize secret
echo "Creating initial secret..."
docker exec vault vault login education > /dev/null 2>&1
docker exec vault vault kv put secret/example test=congrats! > /dev/null 2>&1

echo "Vault is ready at http://localhost:8200"
echo "Token: education"
echo "Run 'terraform apply' to complete the task"
EOF

chmod +x setup-vault.sh

## 10. –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

# –ó–∞–ø—É—Å—Ç–∏–º —Å–∫—Ä–∏–ø—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
./setup-vault.sh

# –ü—Ä–æ–≤–µ—Ä–∏–º Terraform outputs
terraform output

# –ü—Ä–æ–≤–µ—Ä–∏–º Web UI –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å
curl -s http://localhost:8200/v1/sys/health | jq .
11. –°–æ–∑–¥–∞–¥–∏–º —Ñ–∞–π–ª —Å —Ä–µ—à–µ–Ω–∏–µ–º –ø—Ä–æ–±–ª–µ–º—ã –ø—Ä–∞–≤

cat > DOCKER_PERMISSIONS_FIX.md << 'EOF'
# Fix for Docker Permission Issues

1. –°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–¥–∏–º –∫–æ–º–º–∏—Ç –≤ —Ç–µ–∫—É—â–µ–π –≤–µ—Ç–∫–µ

# –ü—Ä–æ–≤–µ—Ä–∏–º —Å—Ç–∞—Ç—É—Å
 git status

# –°–æ–∑–¥–∞–¥–∏–º –∫–æ–º–º–∏—Ç
git commit -m "Complete task 7*: HashiCorp Vault integration with Terraform

- Deployed Vault server using Docker with KV v1 engine
- Created initial secret 'secret/example' via Vault CLI
- Configured Terraform Vault provider with token authentication
- Successfully read existing secrets using vault_generic_secret data source
- Created new secrets using vault_generic_secret resource
- Implemented proper output display using nonsensitive() function
- Verified integration through comprehensive testing script
- All requirements met: secret creation, reading, and output display"

2. –°–æ–∑–¥–∞–¥–∏–º –Ω–æ–≤—É—é –≤–µ—Ç–∫—É –¥–ª—è –∑–∞–¥–∞–Ω–∏—è 7* –∏–∑ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è

# –°–æ–∑–¥–∞–¥–∏–º –Ω–æ–≤—É—é –≤–µ—Ç–∫—É –¥–ª—è –∑–∞–¥–∞–Ω–∏—è 7*
git checkout -b task7-vault-final

3. –ó–∞–ø—É—à–∏–º –Ω–æ–≤—É—é –≤–µ—Ç–∫—É –≤ —É–¥–∞–ª–µ–Ω–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git push -u origin task7-vault-final


https://github.com/sapr797/ter-homeworks/pull/5


### Solution 1: Add user to docker group

sudo usermod -aG docker $USER
newgrp docker  # Apply group changes without logout
Solution 2: Use sudo (temporary)

sudo docker [command]
Solution 3: Change socket permissions (not recommended for production)
bash
sudo chmod 666 /var/run/docker.sock
Solution 4: Use podman as Docker alternative

sudo apt install podman
alias docker=podman
Verification
After applying Solution 1:

groups  # Should show 'docker' in the list
docker ps  # Should work without errors
EOF

cd ~/ter-homeworks-new

# –ü—Ä–æ–≤–µ—Ä–∏–º —Å—Ç–∞—Ç—É—Å
git status

# –î–æ–±–∞–≤–∏–º –≤—Å–µ —Ñ–∞–π–ª—ã –∑–∞–¥–∞–Ω–∏—è 7*
git add 07-vault/


Verification Results:
‚úÖ Vault container running and accessible
‚úÖ Secret 'secret/example' created and readable
‚úÖ Secret 'secret/terraform-generated' created via Terraform
‚úÖ All Terraform outputs display correct values
‚úÖ Vault CLI commands work correctly
‚úÖ Web UI accessible at http://localhost:8200"

# –°–æ–∑–¥–∞–¥–∏–º –≤–µ—Ç–∫—É –¥–ª—è PR
git checkout -b task7-vault-docker-fix
git push origin task7-vault-docker-fix
13. –°–æ–∑–¥–∞–¥–∏–º Pull Request
–¢–µ–ø–µ—Ä—å —Å–æ–∑–¥–∞–π—Ç–µ PR –≤ –≤–∞—à–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏:

https://github.com/sapr797/ter-homeworks/compare/main...task7-vault-docker-fix
14. –û—á–∏—Å—Ç–∫–∞ (–∫–æ–≥–¥–∞ –∑–∞–∫–æ–Ω—á–∏—Ç–µ —Ä–∞–±–æ—Ç—É)

# –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–∫—Ä–∏–ø—Ç –æ—á–∏—Å—Ç–∫–∏
echo "docker stop vault && docker rm vault" > cleanup.sh
chmod +x cleanup.sh

## 12. –û–±–Ω–æ–≤–∏–º Terraform –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

# –ü—Ä–∏–º–µ–Ω–∏–º —Ñ–∏–Ω–∞–ª—å–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
docker-compose exec terraform terraform apply -auto-approve
13. –ü—Ä–æ–≤–µ—Ä–∏–º –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

# –ü—Ä–æ—Å–º–æ—Ç—Ä–∏–º –≤—Å–µ outputs
docker-compose exec terraform terraform output

# –ü—Ä–æ–≤–µ—Ä–∏–º —Å–ø–∏—Å–æ–∫ —Å–µ–∫—Ä–µ—Ç–æ–≤ –≤ Vault
docker-compose exec vault vault kv list secret/
14. –î–æ–±–∞–≤–∏–º –≤—Å–µ –≤ git

cd ~/ter-homeworks-new

# –î–æ–±–∞–≤–∏–º –∑–∞–¥–∞–Ω–∏–µ 7*
git add 07-vault/

# –°–æ–∑–¥–∞–¥–∏–º –∫–æ–º–º–∏—Ç
git commit -m "Complete task 7*: HashiCorp Vault integration with Terraform

- Deploy Vault server using Docker Compose
- Configure Vault provider in Terraform
- Read existing secrets from Vault using data source
- Create new secrets in Vault using Terraform resource
- Output secrets using nonsensitive function
- Provide comprehensive documentation and examples"

# Push –≤ –≤–µ—Ç–∫—É
git push origin terraform-hotfix-final
15. –°–æ–∑–¥–∞–¥–∏–º Pull Request –¥–ª—è –∑–∞–¥–∞–Ω–∏—è 7*

# –°–æ–∑–¥–∞–¥–∏–º –Ω–æ–≤—É—é –≤–µ—Ç–∫—É –¥–ª—è –∑–∞–¥–∞–Ω–∏—è 7*
git checkout -b task7-vault-integration

# –ó–∞–ø—É—à–∏–º –≤–µ—Ç–∫—É
git push origin task7-vault-integration
–¢–µ–ø–µ—Ä—å —Å–æ–∑–¥–∞–π—Ç–µ PR –≤ –≤–∞—à–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏:

https://github.com/sapr797/ter-homeworks/compare/main...task7-vault-integration

16. –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:
Vault –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ http://127.0.0.1:8200
–°–µ–∫—Ä–µ—Ç—ã —á–∏—Ç–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ Terraform
–ù–æ–≤—ã–µ —Å–µ–∫—Ä–µ—Ç—ã —Å–æ–∑–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ Terraform

–í—Å–µ —Ñ–∞–π–ª—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ git

https://github.com/sapr797/ter-homeworks/pull/4

4. –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ —Å–¥–∞—á–µ–π
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ PR –≤–∫–ª—é—á–µ–Ω—ã:

‚úÖ –í—Å–µ —Ñ–∞–π–ª—ã –∏–∑ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ 07-vault/
‚úÖ Terraform –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (main.tf)
‚úÖ Docker Compose —Ñ–∞–π–ª (docker-compose.yml)
‚úÖ –°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ (verify_completion.sh)
‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (README.md)
‚úÖ –ö–æ–º–º–∏—Ç —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º –æ–ø–∏—Å–∞–Ω–∏–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è

5. –û—á–∏—Å—Ç–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
–ö–æ–≥–¥–∞ –∑–∞–¥–∞–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ –∏ –ø—Ä–∏–Ω—è—Ç–æ, –º–æ–∂–Ω–æ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã:

cd ~/ter-homeworks-new/07-vault
docker-compose down
docker stop vault 2>/dev/null || true
docker rm vault 2>/dev/null || true
docker network rm vault-network 2>/dev/null || true

6. –ß—Ç–æ –±—ã–ª–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ –≤ –∑–∞–¥–∞–Ω–∏–∏ 7*
–ó–∞–¥–∞–Ω–∏–µ 7 –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≤–µ—Ä—à–µ–Ω–æ!* –í—ã —É—Å–ø–µ—à–Ω–æ:
–†–∞–∑–≤–µ—Ä–Ω—É–ª–∏ Vault –ª–æ–∫–∞–ª—å–Ω–æ —Å –ø–æ–º–æ—â—å—é Docker
–ù–∞—Å—Ç—Ä–æ–∏–ª–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é —Å —Ç–æ–∫–µ–Ω–æ–º "education"
–°–æ–∑–¥–∞–ª–∏ —Å–µ–∫—Ä–µ—Ç —á–µ—Ä–µ–∑ CLI –ø–æ –ø—É—Ç–∏ secret/example
–ü—Ä–æ—á–∏—Ç–∞–ª–∏ —Å–µ–∫—Ä–µ—Ç —Å –ø–æ–º–æ—â—å—é Terraform –∏ –≤—ã–≤–µ–ª–∏ –≤ output
–°–æ–∑–¥–∞–ª–∏ –Ω–æ–≤—ã–π —Å–µ–∫—Ä–µ—Ç —á–µ—Ä–µ–∑ Terraform
–ü—Ä–æ–≤–µ—Ä–∏–ª–∏ —Ä–∞–±–æ—Ç—É —á–µ—Ä–µ–∑ CLI –∏ Web UI


7. –ü—Ä–æ–≤–µ—Ä–∏–º, —á—Ç–æ –≤—Å–µ —Ñ–∞–π–ª—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã

# –ü—Ä–æ–≤–µ—Ä–∏–º, —á—Ç–æ —Ñ–∞–π–ª—ã –∑–∞–¥–∞–Ω–∏—è 7* –≤ –∫–æ–º–º–∏—Ç–µ
git log --oneline -1 --name-only


https://github.com/sapr797/ter-homeworks/compare/main...terraform-hotfix-final


# –î–æ–±–∞–≤–∏–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π —Ñ–∞–π–ª
git add variables.tf  # –∏–ª–∏ –∏–º—è –≤–∞—à–µ–≥–æ —Ñ–∞–π–ª–∞

# –ü—Ä–æ–≤–µ—Ä–∏–º —Å—Ç–∞—Ç—É—Å
git status

# –ï—Å–ª–∏ –≤—Å–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã —Ä–µ—à–µ–Ω—ã, —Å–æ–∑–¥–∞–¥–∏–º –∫–æ–º–º–∏—Ç
git commit -m "Resolve merge conflict in variables.tf"

https://github.com/sapr797/ter-homeworks/pull/5


1. –ü—Ä–æ–≤–µ—Ä–∏–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

# –ü–µ—Ä–µ–∫–ª—é—á–∏–º—Å—è –Ω–∞ main
git checkout main

# –û–±–Ω–æ–≤–∏–º –ª–æ–∫–∞–ª—å–Ω—É—é –≤–µ—Ç–∫—É
git pull origin main

# –ü—Ä–æ–≤–µ—Ä–∏–º, —á—Ç–æ –∑–∞–¥–∞–Ω–∏–µ 7* –µ—Å—Ç—å –≤ main
ls -la 07-vault/

# –ü—Ä–æ–≤–µ—Ä–∏–º –∏—Å—Ç–æ—Ä–∏—é –∫–æ–º–º–∏—Ç–æ–≤
git log --oneline -5

3. –ü—Ä–æ–≤–µ—Ä–∏–º —Å—Ç–∞—Ç—É—Å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
bash
# –ü—Ä–æ–≤–µ—Ä–∏–º —Å—Ç–∞—Ç—É—Å
git status

# –ü—Ä–æ–≤–µ—Ä–∏–º –≤–µ—Ç–∫–∏
git branch -a

# –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ main –∞–∫—Ç—É–∞–ª—å–Ω–∞
git log --oneline -1
4. –û—á–∏—Å—Ç–∫–∞ –Ω–µ–Ω—É–∂–Ω—ã—Ö –≤–µ—Ç–æ–∫ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
–¢–µ–ø–µ—Ä—å, –∫–æ–≥–¥–∞ –∑–∞–¥–∞–Ω–∏–µ 7* –≤ main, –º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –≤–µ—Ç–∫–∏:

bash
# –£–¥–∞–ª–∏–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –≤–µ—Ç–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω—ã
git branch -d task7-vault-final
git branch -d task7-only
git branch -d temp-changes
git branch -d new-feature

# –£–¥–∞–ª–∏–º remote –≤–µ—Ç–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω—ã
git push origin --delete task7-vault-final
git push origin --delete task7-only


https://github.com/sapr797/ter-homeworks/tree/main/07-vault

















 








### –ó–∞–¥–∞–Ω–∏–µ 8*
–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏ –∏ —Å –ø–æ–º–æ—â—å—é terraform remote state —Ä–∞–∑–¥–µ–ª–∏—Ç—å root –º–æ–¥—É–ª—å –Ω–∞ –¥–≤–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö root-–º–æ–¥—É–ª—è: —Å–æ–∑–¥–∞–Ω–∏–µ VPC , —Å–æ–∑–¥–∞–Ω–∏–µ –í–ú . 



---------------------

1. –°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–¥–∏–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π

cd ~/ter-homeworks-new
mkdir -p 08-remote-state-modules/{vpc_module,vm_module}

2. –°–æ–∑–¥–∞–¥–∏–º –º–æ–¥—É–ª—å VPC
vpc_module/main.tf

cat > 08-remote-state-modules/vpc_module/main.tf << 'EOF'
terraform {
  required_version = ">= 1.5"
  required_providers {
    yandex = {
      source  = "yandex-cloud/yandex"
      version = ">= 0.92.0"
    }
  }

  backend "s3" {
    endpoint   = "storage.yandexcloud.net"
    bucket     = "tf-homework-b1gokds****eobjh-001"  # –í–∞—à bucket –∏–∑ –∑–∞–¥–∞–Ω–∏—è 6*
    key        = "vpc/terraform.tfstate"
    access_key = "YCAJE9********7Gx3i"  # –í–∞—à access key
    secret_key = "YCPM2JXbXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"  # –í–∞—à secret key
    
    skip_region_validation      = true
    skip_credentials_validation = true
  }
}

provider "yandex" {
  folder_id = "b1gokds3ue11292eobjh"  # –í–∞—à folder_id
}

# –°–æ–∑–¥–∞–µ–º VPC —Å–µ—Ç—å
resource "yandex_vpc_network" "main" {
  name        = "main-network"
  description = "Main network for homework"
}

# –°–æ–∑–¥–∞–µ–º –ø–æ–¥—Å–µ—Ç—å
resource "yandex_vpc_subnet" "main" {
  name           = "main-subnet"
  zone           = "ru-central1-a"
  network_id     = yandex_vpc_network.main.id
  v4_cidr_blocks = ["192.168.10.0/24"]
  
  labels = {
    environment = "learning"
    project     = "terraform-homework"
  }
}

# –ì—Ä—É–ø–ø–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
resource "yandex_vpc_security_group" "main" {
  name        = "main-security-group"
  description = "Main security group for VMs"
  network_id  = yandex_vpc_network.main.id

  ingress {
    protocol       = "TCP"
    description    = "SSH access"
    v4_cidr_blocks = ["0.0.0.0/0"]
    port           = 22
  }

  ingress {
    protocol       = "TCP"
    description    = "HTTP access"
    v4_cidr_blocks = ["0.0.0.0/0"]
    port           = 80
  }

  ingress {
    protocol       = "TCP"
    description    = "HTTPS access"
    v4_cidr_blocks = ["0.0.0.0/0"]
    port           = 443
  }

  egress {
    protocol       = "ANY"
    description    = "Outbound traffic"
    v4_cidr_blocks = ["0.0.0.0/0"]
  }
}
EOF



https://github.com/sapr797/ter-homeworks/pull/7




–û–±–Ω–æ–≤–∏—Ç–µ workflow –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
–ò–∑–º–µ–Ω–∏—Ç–µ .github/workflows/terraform-check.yml:

yaml
- name: Terraform Init & Validate
  run: |
    for dir in ${{ steps.changes.outputs.dirs }}; do
      if [ -d "$dir" ] && [ -f "$dir/*.tf" ]; then
        echo "=== Processing $dir ==="
        cd "$dir"
        
        # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å —Ñ–∏–∫—Ç–∏–≤–Ω—ã–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏
        terraform init -backend=false \
          -var="cloud_id=fake" \
          -var="folder_id=fake" \
          -var="token=fake" \
          -var="service_account_key_file=fake" || echo "Init completed with mocked vars"
        
        # –í–∞–ª–∏–¥–∞—Ü–∏—è
        terraform validate -json | jq -r '"Valid: \(.valid)\nError: \(.error)"'
        cd - > /dev/null
        echo "---"
      fi
    done






 –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
bash
git add .
git commit -m "fix: add provider configurations for validation"
git push origin task8-remote-state-modules




–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª—ã provider.tf –≤ –∫–∞–∂–¥–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å –ø–æ–º–æ—â—å—é —ç—Ç–∏—Ö –∫–æ–º–∞–Ω–¥:

–î–ª—è Yandex Cloud –º–æ–¥—É–ª–µ–π:
1. 04/src/

cat > 04/src/provider.tf << 'EOF'
terraform {
  required_providers {
    yandex = {
      source  = "yandex-cloud/yandex"
      version = ">= 0.80.0"
    }
  }
}

provider "yandex" {
  cloud_id  = "fake-cloud-id"
  folder_id = "fake-folder-id" 
  zone      = "ru-central1-a"
}
EOF
2. 04/src/06-s3-bucket/

cat > 04/src/06-s3-bucket/provider.tf << 'EOF'
terraform {
  required_providers {
    yandex = {
      source  = "yandex-cloud/yandex"
      version = ">= 0.80.0"
    }
  }
}

provider "yandex" {
  cloud_id  = "fake-cloud-id"
  folder_id = "fake-folder-id" 
  zone      = "ru-central1-a"
}
EOF
3. 08-remote-state-modules/vpc_module/

cat > 08-remote-state-modules/vpc_module/provider.tf << 'EOF'
terraform {
  required_providers {
    yandex = {
      source  = "yandex-cloud/yandex"
      version = ">= 0.80.0"
    }
  }
}

provider "yandex" {
  cloud_id  = "fake-cloud-id"
  folder_id = "fake-folder-id" 
  zone      = "ru-central1-a"
}
EOF
4. 08-remote-state-modules/vm_module/

cat > 08-remote-state-modules/vm_module/provider.tf << 'EOF'
terraform {
  required_providers {
    yandex = {
      source  = "yandex-cloud/yandex"
      version = ">= 0.80.0"
    }
  }
}

provider "yandex" {
  cloud_id  = "fake-cloud-id"
  folder_id = "fake-folder-id" 
  zone      = "ru-central1-a"
}
EOF
5. validation_test/ (–µ—Å–ª–∏ —ç—Ç–æ Yandex Cloud –º–æ–¥—É–ª—å)


cat > validation_test/provider.tf << 'EOF'
terraform {
  required_providers {
    yandex = {
      source  = "yandex-cloud/yandex"
      version = ">= 0.80.0"
    }
  }
}

provider "yandex" {
  cloud_id  = "fake-cloud-id"
  folder_id = "fake-folder-id" 
  zone      = "ru-central1-a"
}
EOF
–î–ª—è Vault –º–æ–¥—É–ª—è:
6. 07-vault/


cat > 07-vault/provider.tf << 'EOF'
terraform {
  required_providers {
    vault = {
      source  = "hashicorp/vault"
      version = ">= 3.0.0"
    }
  }
}

provider "vault" {
  address = "http://localhost:8200"
}
EOF
–ü—Ä–æ–≤–µ—Ä–∫–∞:
–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:


# –ü—Ä–æ–≤–µ—Ä–∏–º, —á—Ç–æ —Ñ–∞–π–ª—ã —Å–æ–∑–¥–∞–Ω—ã
find . -name "provider.tf" -type f

# –ü—Ä–æ–≤–µ—Ä–∏–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
terraform fmt -recursive

# –ó–∞–ø—É—Å—Ç–∏–º –ø—Ä–æ–≤–µ—Ä–∫—É —Å–∫—Ä–∏–ø—Ç–æ–º
./check_critical_dirs.sh
–ö–æ–º–º–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π:

git add .
git commit -m "fix: add provider configurations for all modules"
git push origin task8-remote-state-modules


1. –ò—Å–ø—Ä–∞–≤—å—Ç–µ —Ñ–∞–π–ª 04/src/main.tf

# –ü—Ä–æ—Å–º–æ—Ç—Ä–∏–º —Ç–µ–∫—É—â–µ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
cat 04/src/main.tf

# –ò—Å–ø—Ä–∞–≤–∏–º —Ñ–∞–π–ª - —É–¥–∞–ª–∏–º –ª–∏—à–Ω–∏–µ —Å–∫–æ–±–∫–∏ –≤ –Ω–∞—á–∞–ª–µ
cat > 04/src/main.tf << 'EOF'
# –°–æ–∑–¥–∞–µ–º —Å–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç –¥–ª—è –±–∞–∫–µ—Ç–∞
resource "yandex_iam_service_account" "s3_sa" {
  name        = "s3-bucket-sa"
  description = "Service account for S3 bucket management"
}

# –î–∞–µ–º –ø—Ä–∞–≤–∞ –Ω–∞ storage.editor
resource "yandex_resourcemanager_folder_iam_member" "s3_editor" {
  folder_id = "b1gokds3ue11292eobjh"
  role      = "storage.editor"
  member    = "serviceAccount:${yandex_iam_service_account.s3_sa.id}"
}

# –°–æ–∑–¥–∞–µ–º —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –∫–ª—é—á–∏ –¥–æ—Å—Ç—É–ø–∞
resource "yandex_iam_service_account_static_access_key" "s3_sa_keys" {
  service_account_id = yandex_iam_service_account.s3_sa.id
  description        = "Static access keys for S3 bucket"
}

# –°–æ–∑–¥–∞–µ–º S3 –±–∞–∫–µ—Ç —Å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–º –∏–º–µ–Ω–µ–º
resource "yandex_storage_bucket" "homework_bucket" {
  # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏–º—è –Ω–∞ –æ—Å–Ω–æ–≤–µ folder_id –±–µ–∑ –¥–µ—Ñ–∏—Å–æ–≤ + —Å—É—Ñ—Ñ–∏–∫—Å
  bucket     = "tf-homework-${replace("b1gokds3ue11292eobjh", "-", "")}-001"
  access_key = yandex_iam_service_account_static_access_key.s3_sa_keys.access_key
  secret_key = yandex_iam_service_account_static_access_key.s3_sa_keys.secret_key

  max_size = 1073741824 # 1 GB in bytes

  anonymous_access_flags {
    read = false
    list = false
  }
}
EOF
2. –ü—Ä–æ–≤–µ—Ä–∏–º —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤

# –ü—Ä–æ–≤–µ—Ä–∏–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
terraform fmt -recursive

# –ü—Ä–æ–≤–µ—Ä–∏–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ –ø—Ä–æ–±–ª–µ–º–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
cd 04/src
terraform validate
cd ../..
3. –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ –≤ –¥—Ä—É–≥–∏—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è—Ö –Ω–µ—Ç –ø—Ä–æ–±–ª–µ–º

# –ü—Ä–æ–≤–µ—Ä–∏–º 07-vault
cd 07-vault
terraform validate
cd ..

# –ü—Ä–æ–≤–µ—Ä–∏–º –º–æ–¥—É–ª–∏
cd 08-remote-state-modules/vpc_module
terraform validate
cd ../..

cd 08-remote-state-modules/vm_module  
terraform validate
cd ../..
4. –ó–∞–ø—É—Å—Ç–∏–º –ª–æ–∫–∞–ª—å–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É

./check_critical_dirs.sh
5. –ö–æ–º–º–∏—Ç –∏ –ø—É—à –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

git add 04/src/main.tf
git commit -m "fix: remove extra closing braces from main.tf"
git push origin task8-remote-state-modules

4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Å–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤

# –í–µ—Ä–Ω–∏—Ç–µ—Å—å –≤ –∫–æ—Ä–µ–Ω—å
cd ~/ter-homeworks-new

# –ü—Ä–æ–≤–µ—Ä–∏–º –≤—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –Ω–∞ –¥—É–±–ª–∏—Ä—É—é—â–∏–µ provider —Ñ–∞–π–ª—ã
find . -name "provider*.tf" -type f | grep -E "(04/src|07-vault|08-remote-state-modules|validation_test)"
5. –ò—Å–ø—Ä–∞–≤—å—Ç–µ –¥—Ä—É–≥–∏–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –¥—É–±–ª–∏–∫–∞—Ç—ã
–ï—Å–ª–∏ –Ω–∞–π–¥–µ—Ç–µ –¥—Ä—É–≥–∏–µ –¥—É–±–ª–∏–∫–∞—Ç—ã, —É–¥–∞–ª–∏—Ç–µ –∏—Ö:


# –ù–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –≤ –∫–∞–∫–æ–π-—Ç–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –µ—Å—Ç—å –∏ provider.tf –∏ providers.tf
find . -name "providers.tf" -type f -delete
6. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Å–µ –º–æ–¥—É–ª–∏

./check_critical_dirs.sh
7. –ö–æ–º–º–∏—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

git add .
git commit -m "fix: remove duplicate provider configurations"
git push origin task8-remote-state-modules

8.1. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –≤ –∫–∞–∂–¥–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏

# –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –∫–æ—Ä–Ω–µ–≤—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
cd ~/ter-homeworks-new

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –≤—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
for dir in 04/src 07-vault 08-remote-state-modules/vpc_module 08-remote-state-modules/vm_module validation_test; do
  if [ -d "$dir" ]; then
    echo "=== Initializing $dir ==="
    cd "$dir"
    terraform init -backend=false
    cd - > /dev/null
  fi
done

9. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–∞–ª–∏–¥–∞—Ü–∏—é –ø–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏

# –ü—Ä–æ–≤–µ—Ä–∏–º –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤ –ø—Ä–æ–±–ª–µ–º–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
cd 04/src
terraform validate

# –ï—Å–ª–∏ –≤—Å–µ —Ö–æ—Ä–æ—à–æ, –¥–æ–ª–∂–Ω–æ –≤—ã–≤–µ—Å—Ç–∏:
# Success! The configuration is valid.
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Å–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏

# –í–µ—Ä–Ω–∏—Ç–µ—Å—å –≤ –∫–æ—Ä–µ–Ω—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–π —Å–∫—Ä–∏–ø—Ç
cd ~/ter-homeworks-new
./check_critical_dirs.sh

4. –ï—Å–ª–∏ –≤—Å–µ –µ—â–µ –µ—Å—Ç—å –æ—à–∏–±–∫–∏, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–µ—Ä—Å–∏—é –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
–í —Ñ–∞–π–ª–µ 04/src/provider.tf –º–æ–∂–µ—Ç –±—ã—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç –≤–µ—Ä—Å–∏–π. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ–±–Ω–æ–≤–∏—Ç–µ:

# –ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —Ç–µ–∫—É—â—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
cat 04/src/provider.tf

# –ï—Å–ª–∏ –Ω—É–∂–Ω–æ, –æ–±–Ω–æ–≤–∏—Ç–µ –≤–µ—Ä—Å–∏—é (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç—É –∂–µ –≤–µ—Ä—Å–∏—é, —á—Ç–æ –≤ GitHub Actions)
cat > 04/src/provider.tf << 'EOF'
terraform {
  required_providers {
    yandex = {
      source  = "yandex-cloud/yandex"
      version = ">= 0.92.0"
    }
  }
}

provider "yandex" {
  cloud_id  = "fake-cloud-id"
  folder_id = "fake-folder-id" 
  zone      = "ru-central1-a"
}
EOF

5. –ü–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

cd 04/src
terraform init -upgrade
terraform validate
6. –ö–æ–º–º–∏—Ç –∏ –ø—É—à

# –î–æ–±–∞–≤—å—Ç–µ lock —Ñ–∞–π–ª—ã (–µ—Å–ª–∏ –æ–Ω–∏ –±—ã–ª–∏ —Å–æ–∑–¥–∞–Ω—ã)
git add .terraform.lock.hcl 04/src/.terraform.lock.hcl 2>/dev/null || true

git add .
git commit -m "fix: initialize terraform providers"
git push origin task8-remote-state-modules


10.–í—ã–ø–æ–ª–Ω–∏—Ç–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –≤–æ –≤—Å–µ—Ö –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è—Ö

# –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –∫–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞
cd ~/ter-homeworks-new

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –≤—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
for dir in 04/src 04/src/06-s3-bucket 07-vault 08-remote-state-modules/vpc_module 08-remote-state-modules/vm_module validation_test; do
  if [ -d "$dir" ]; then
    echo "=== Initializing $dir ==="
    cd "$dir"
    terraform init -backend=false
    cd - > /dev/null
    echo "---"
  fi
done

11. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–∞–ª–∏–¥–∞—Ü–∏—é –ø–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
# –ü—Ä–æ–≤–µ—Ä–∏–º –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤ –∫–∞–∂–¥–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
for dir in 04/src 04/src/06-s3-bucket 07-vault 08-remote-state-modules/vpc_module 08-remote-state-modules/vm_module validation_test; do
  if [ -d "$dir" ]; then
    echo "=== Validating $dir ==="
    cd "$dir"
    terraform validate
    cd - > /dev/null
    echo "---"
  fi
done

12. –î–æ–±–∞–≤—å—Ç–µ .terraform.lock.hcl —Ñ–∞–π–ª—ã –≤ git

# –ù–∞–π–¥–µ–º –≤—Å–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ lock —Ñ–∞–π–ª—ã
find . -name ".terraform.lock.hcl" -type f

# –î–æ–±–∞–≤–∏–º –∏—Ö –≤ git
git add $(find . -name ".terraform.lock.hcl" -type f)

# –ò–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ –≤—Å–µ lock —Ñ–∞–π–ª—ã
git add */.terraform.lock.hcl 2>/dev/null || true


13. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ñ–∏–Ω–∞–ª—å–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É
 ./check_critical_dirs.sh

12.–ö–æ–º–º–∏—Ç –∏ –ø—É—à –∏–∑–º–µ–Ω–µ–Ω–∏–π
git add .
git commit -m "fix: initialize terraform providers in all critical directories"
git push origin task8-remote-state-modules

14.J–±–Ω–æ–≤–∏—Ç–µ –≤–µ—Ä—Å–∏—é –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –≤ —Ñ–∞–π–ª–∞—Ö provider.tf —á—Ç–æ–±—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —Ç–æ–π, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ GitHub Actions:


# –î–ª—è Yandex –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
find . -name "provider.tf" -type f -exec sed -i 's/version = ">= 0.80.0"/version = ">= 0.92.0"/g' {} \;

# –ü–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤–µ—Ä—Å–∏–π
./init_all.sh

15. –£–¥–∞–ª–∏—Ç–µ –¥—É–±–ª–∏—Ä—É—é—â–∏–µ provider.tf —Ñ–∞–π–ª—ã

# –£–¥–∞–ª—è–µ–º provider.tf —Ñ–∞–π–ª—ã —Ç–∞–º, –≥–¥–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —É–∂–µ –µ—Å—Ç—å –≤ main.tf
rm 04/src/06-s3-bucket/provider.tf
rm 07-vault/provider.tf
rm 08-remote-state-modules/vpc_module/provider.tf
rm 08-remote-state-modules/vm_module/provider.tf

# –û—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –≤ —Ç–µ—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è—Ö, –≥–¥–µ –Ω–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –≤ main.tf
# 04/src/provider.tf - –æ—Å—Ç–∞–≤–ª—è–µ–º (—Ç–∞–º –Ω–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç–∞)
# validation_test/provider.tf - –æ—Å—Ç–∞–≤–ª—è–µ–º (—Ç–∞–º –Ω–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç–∞)

16.–ü—Ä–æ–≤–µ—Ä–∏–º, —á—Ç–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –µ—Å—Ç—å –≤ main.tf —Ñ–∞–π–ª–∞—Ö

# –ü—Ä–æ–≤–µ—Ä–∏–º –Ω–∞–ª–∏—á–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –≤ main.tf —Ñ–∞–π–ª–∞—Ö
for dir in 04/src/06-s3-bucket 07-vault 08-remote-state-modules/vpc_module 08-remote-state-modules/vm_module; do
  if [ -d "$dir" ]; then
    echo "=== Checking $dir/main.tf for provider configuration ==="
    grep -A 10 "required_providers" "$dir/main.tf" || echo "No provider config found in main.tf"
    echo "---"
  fi
done

17. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –±–µ–∑ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏, –≥–¥–µ –Ω–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
for dir in 04/src/06-s3-bucket 07-vault 08-remote-state-modules/vpc_module 08-remote-state-modules/vm_module; do
  if [ -d "$dir" ]; then
    echo "=== Initializing $dir ==="
    cd "$dir"
    terraform init -backend=false
    terraform validate
    cd - > /dev/null
    echo "---"
  fi
done

18.–ò—Å–ø—Ä–∞–≤–∏–º –ø—Ä–æ–±–ª–µ–º—É —Å –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ–π –≤ validation_test

cd validation_test
terraform providers lock -platform=linux_amd64
terraform init -backend=false
terraform validate
cd ..

5. –ü—Ä–æ–≤–µ—Ä–∏–º –≤—Å–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏

./check_critical_dirs.sh

6. –ö–æ–º–º–∏—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

git add .
git commit -m "fix: remove duplicate provider configurations and fix platform locks"
git push origin task8-remote-state-modules

18.7. –ï—Å–ª–∏ –≤ –∫–∞–∫–∏—Ö-—Ç–æ main.tf –Ω–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
–ï—Å–ª–∏ –æ–∫–∞–∂–µ—Ç—Å—è, —á—Ç–æ –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö main.tf —Ñ–∞–π–ª–∞—Ö –Ω–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞, —Ç–æ –Ω—É–∂–Ω–æ –ª–∏–±–æ:

–í–∞—Ä–∏–∞–Ω—Ç A: –î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ main.tf

# –ü—Ä–∏–º–µ—Ä –¥–ª—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏, –≥–¥–µ –Ω–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
cat >> 04/src/06-s3-bucket/main.tf << 'EOF'

terraform {
  required_providers {
    yandex = {
      source  = "yandex-cloud/yandex"
      version = ">= 0.92.0"
    }
  }
}

provider "yandex" {
  cloud_id  = "fake-cloud-id"
  folder_id = "fake-folder-id"
  zone      = "ru-central1-a"
}
EOF


8. –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

# –ü—Ä–æ–≤–µ—Ä–∏–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
terraform fmt -recursive

# –ó–∞–ø—É—Å—Ç–∏–º –ø—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–π —Å–∫—Ä–∏–ø—Ç
./check_critical_dirs.sh

# –ü—Ä–æ–≤–µ—Ä–∏–º –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤—Ä—É—á–Ω—É—é –≤ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è—Ö
for dir in 04/src/06-s3-bucket 07-vault 08-remote-state-modules/vpc_module 08-remote-state-modules/vm_module; do
  if [ -d "$dir" ]; then
    echo "=== Validating $dir ==="
    cd "$dir"
    terraform validate
    cd - > /dev/null
  fi
done

1. –ò—Å–ø—Ä–∞–≤–∏–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ checksums –¥–ª—è Yandex –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞

# –ü–µ—Ä–µ–π–¥–µ–º –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é validation_test
cd ~/ter-homeworks-new/validation_test

# –ü–æ–ø—Ä–æ–±—É–µ–º –æ–±–Ω–æ–≤–∏—Ç—å lock —Ñ–∞–π–ª —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º
terraform init -reconfigure -backend=false

# –ò–ª–∏ –ø—Ä–æ—Å—Ç–æ —É–¥–∞–ª–∏–º lock —Ñ–∞–π–ª –∏ –ø–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º
rm -f .terraform.lock.hcl
terraform init -backend=false
2. –ò—Å–ø—Ä–∞–≤–∏–º deprecated –ø–∞—Ä–∞–º–µ—Ç—Ä –≤ 08-remote-state-modules/vm_module

# –ü–µ—Ä–µ–π–¥–µ–º –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é vm_module
cd ~/ter-homeworks-new/08-remote-state-modules/vm_module

# –ü–æ—Å–º–æ—Ç—Ä–∏–º –Ω–∞ –ø—Ä–æ–±–ª–µ–º–Ω—ã–π –∫–æ–¥
grep -n "endpoint" main.tf

# –ò—Å–ø—Ä–∞–≤–∏–º deprecated –ø–∞—Ä–∞–º–µ—Ç—Ä endpoint –Ω–∞ endpoints.s3
# –ù—É–∂–Ω–æ –Ω–∞–π—Ç–∏ –±–ª–æ–∫ backend "s3" –∏ –∑–∞–º–µ–Ω–∏—Ç—å "endpoint" –Ω–∞ "endpoints = { s3 = ... }"
–ï—Å–ª–∏ –≤ main.tf –µ—Å—Ç—å —Ç–∞–∫–æ–π –±–ª–æ–∫:


backend "s3" {
  endpoint = "some-url"
}
–ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞:

backend "s3" {
  endpoints = {
    s3 = "some-url"
  }
}

3. –ü—Ä–æ–≤–µ—Ä–∏–º –≤—Å–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

cd ~/ter-homeworks-new

# –ü—Ä–æ–≤–µ—Ä–∏–º –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤–æ –≤—Å–µ—Ö –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è—Ö
for dir in 04/src 04/src/06-s3-bucket 07-vault 08-remote-state-modules/vpc_module 08-remote-state-modules/vm_module validation_test; do
  if [ -d "$dir" ]; then
    echo "=== Validating $dir ==="
    cd "$dir"
    terraform validate
    cd - > /dev/null
    echo "---"
  fi
done
4. –ó–∞–ø—É—Å—Ç–∏–º —Ñ–∏–Ω–∞–ª—å–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É

./check_critical_dirs.sh
5. –ö–æ–º–º–∏—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

git add .
git commit -m "fix: update deprecated endpoint parameter and fix provider initialization"
git push origin task8-remote-state-modules

# –í workflow –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Ñ–ª–∞–≥ –¥–ª—è –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π
terraform validate -json | jq -e '.valid' > /dev/null

1. –ù–∞–π–¥–µ–º –≤—Å–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è deprecated –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ endpoint

cd ~/ter-homeworks-new

# –ò—â–µ–º –≤—Å–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è endpoint –≤ backend –±–ª–æ–∫–∞—Ö
find . -name "*.tf" -type f -exec grep -l 'endpoint =' {} \; | grep -v ".terraform"
2. –ü—Ä–æ—Å–º–æ—Ç—Ä–∏–º –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ —Ñ–∞–π–ª—ã

# –ü–æ—Å–º–æ—Ç—Ä–∏–º –Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ñ–∞–π–ª–æ–≤, –≥–¥–µ –µ—Å—Ç—å endpoint
for file in $(find . -name "*.tf" -type f -exec grep -l 'endpoint =' {} \; | grep -v ".terraform"); do
  echo "=== File: $file ==="
  grep -A 5 -B 5 'endpoint =' "$file"
  echo "---"
done
3. –ò—Å–ø—Ä–∞–≤–∏–º deprecated –ø–∞—Ä–∞–º–µ—Ç—Ä
–°–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ –ø—Ä–æ–±–ª–µ–º–∞ –≤ —Ñ–∞–π–ª–µ 08-remote-state-modules/vm_module/main.tf. –î–∞–≤–∞–π—Ç–µ –µ–≥–æ –∏—Å–ø—Ä–∞–≤–∏–º:


# –ü–µ—Ä–µ–π–¥–µ–º –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é vm_module
cd 08-remote-state-modules/vm_module

# –°–æ–∑–¥–∞–¥–∏–º —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é
cp main.tf main.tf.backup

# –ò—Å–ø—Ä–∞–≤–∏–º endpoint –Ω–∞ endpoints —Å –ø–æ–º–æ—â—å—é sed
sed -i 's/endpoint =/endpoints = { s3 =/g' main.tf
sed -i 's/\(endpoints = { s3 = "[^"]*"\)/\1 }/g' main.tf

# –ò–õ–ò –ª—É—á—à–µ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º –≤—Ä—É—á–Ω—É—é, –µ—Å–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–º–µ–Ω–∞ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∞

4. –†—É—á–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
–ï—Å–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–º–µ–Ω–∞ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∞, –æ—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ:


nano main.tf
–ù–∞–π–¥–∏—Ç–µ –±–ª–æ–∫, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–≥–ª—è–¥–∏—Ç –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫:


terraform {
  backend "s3" {
    endpoint = "storage.yandexcloud.net"
    # ... –¥—Ä—É–≥–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
  }
}
–ò –∑–∞–º–µ–Ω–∏—Ç–µ –µ–≥–æ –Ω–∞:


terraform {
  backend "s3" {
    endpoints = {
      s3 = "storage.yandexcloud.net"
    }
    # ... –¥—Ä—É–≥–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (bucket, key, region –∏ —Ç.–¥.)
  }
}
5. –ü—Ä–æ–≤–µ—Ä–∏–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

# –ü—Ä–æ–≤–µ—Ä–∏–º, —á—Ç–æ –∑–∞–º–µ–Ω–∞ –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ
grep -A 10 -B 5 "endpoints" main.tf

# –ü—Ä–æ–≤–µ—Ä–∏–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
terraform fmt

# –ü—Ä–æ–≤–µ—Ä–∏–º –≤–∞–ª–∏–¥–∞—Ü–∏—é
terraform validate
6. –ü—Ä–æ–≤–µ—Ä–∏–º –¥—Ä—É–≥–∏–µ —Ñ–∞–π–ª—ã

# –í–µ—Ä–Ω–µ–º—Å—è –≤ –∫–æ—Ä–µ–Ω—å –∏ –ø—Ä–æ–≤–µ—Ä–∏–º –≤—Å–µ —Ñ–∞–π–ª—ã
cd ~/ter-homeworks-new

# –°–Ω–æ–≤–∞ –ø–æ–∏—â–µ–º endpoint
find . -name "*.tf" -type f -exec grep -l 'endpoint =' {} \; | grep -v ".terraform"

# –ï—Å–ª–∏ –æ—Å—Ç–∞–ª–∏—Å—å –¥—Ä—É–≥–∏–µ —Ñ–∞–π–ª—ã —Å endpoint, –∏—Å–ø—Ä–∞–≤–∏–º –∏—Ö –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ
7. –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

# –ü—Ä–æ–≤–µ—Ä–∏–º –≤—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
./check_critical_dirs.sh

# –ü—Ä–æ–≤–µ—Ä–∏–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ vm_module
cd 08-remote-state-modules/vm_module
terraform validate
cd ../..
8. –ö–æ–º–º–∏—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

git add .
git commit -m "fix: update deprecated endpoint parameter to endpoints.s3"
git push origin task8-remote-state-modu

—Å–æ–∑–¥–∞—Ç—å Pull Request (PR) –∏–∑ –≤–µ—Ç–∫–∏ task8-remote-state-modules –≤ –ø–æ–∑–∏—Ç–æ—Ä–∏–π, :

–ß–µ—Ä–µ–∑ GitHub Web Interface 
–ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤–∞—à–µ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è:

# –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
https://github.com/sapr797/ter-homeworks

–°–ø–æ—Å–æ–± 1: –ß–µ—Ä–µ–∑ Git –∫–æ–º–∞–Ω–¥—ã (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞)

# –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –≤–µ—Ç–∫—É
git checkout task8-remote-state-modules

# –û–±–Ω–æ–≤–∏—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ remote
git fetch origin

# –°–æ–∑–¥–∞–π—Ç–µ PR —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
git push -u origin task8-remote-state-modules

G—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º PR:

# –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ —Ñ–∞–π–ª—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã
git status

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –Ω–µ—Ç –æ—à–∏–±–æ–∫ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
./check_critical_dirs.sh

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏—Å—Ç–æ—Ä–∏—é –∫–æ–º–º–∏—Ç–æ–≤
git log --oneline -5


–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π PR:

# –í–Ω–µ—Å–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
git add .
git commit -m "fix: additional improvements"
git push origin task8-remote-state-modules

















### –ü—Ä–∞–≤–∏–ª–∞ –ø—Ä–∏—ë–º–∞ —Ä–∞–±–æ—Ç—ã

–í —Å–≤–æ—ë–º git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é –≤–µ—Ç–∫—É terraform-04, –∑–∞–∫–æ–º–º–∏—Ç—å—Ç–µ –≤ —ç—Ç—É –≤–µ—Ç–∫—É —Å–≤–æ–π —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –∫–æ–¥ –ø—Ä–æ–µ–∫—Ç–∞. –û—Ç–≤–µ—Ç—ã –Ω–∞ –∑–∞–¥–∞–Ω–∏—è –∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Å–∫—Ä–∏–Ω—à–æ—Ç—ã –æ—Ñ–æ—Ä–º–∏—Ç–µ –≤ md-—Ñ–∞–π–ª–µ –≤ –≤–µ—Ç–∫–µ terraform-04.

–í –∫–∞—á–µ—Å—Ç–≤–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –ø—Ä–∏–∫—Ä–µ–ø–∏—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ –≤–µ—Ç–∫—É terraform-04 –≤ –≤–∞—à–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.
















**–í–∞–∂–Ω–æ.** –£–¥–∞–ª–∏—Ç–µ –≤—Å–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã.

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ü–µ–Ω–∫–∏

–ó–∞—á—ë—Ç —Å—Ç–∞–≤–∏—Ç—Å—è, –µ—Å–ª–∏:

* –≤—ã–ø–æ–ª–Ω–µ–Ω—ã –≤—Å–µ –∑–∞–¥–∞–Ω–∏—è,
* –æ—Ç–≤–µ—Ç—ã –¥–∞–Ω—ã –≤ —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç–æ–π —Ñ–æ—Ä–º–µ,
* –ø—Ä–∏–ª–æ–∂–µ–Ω—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Å–∫—Ä–∏–Ω—à–æ—Ç—ã –∏ —Ñ–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞,
* –≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏—è—Ö –Ω–µ—Ç –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–π –∏ –Ω–∞—Ä—É—à–µ–Ω–∏—è –ª–æ–≥–∏–∫–∏.

–ù–∞ –¥–æ—Ä–∞–±–æ—Ç–∫—É —Ä–∞–±–æ—Ç—É –æ—Ç–ø—Ä–∞–≤—è—Ç, –µ—Å–ª–∏:

* –∑–∞–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ —á–∞—Å—Ç–∏—á–Ω–æ –∏–ª–∏ –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ –≤–æ–æ–±—â–µ,
* –≤ –ª–æ–≥–∏–∫–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏–π –µ—Å—Ç—å –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—è –∏ —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–∏. 




